<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Xingyan Xu" />

<meta name="date" content="2024-12-05" />

<title>All my homework</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">All my homework</h1>
<h4 class="author">Xingyan Xu</h4>
<h4 class="date">2024-12-05</h4>



<div id="第一次作业" class="section level1">
<h1>第一次作业</h1>
<div id="题" class="section level2">
<h2>3.4题</h2>
<p>The Rayleigh density [156, Ch. 18] is <span class="math display">\[f(x) = \frac{x}{\sigma^2}
e^{-\frac{x^2}{2\sigma^2}}, \quad x \geq 0, \, \sigma &gt;
0.\]</span></p>
<p>Develop an algorithm to generate random samples from a Rayleigh(<span class="math inline">\(\sigma\)</span>) distribution. Generate
Rayleigh(<span class="math inline">\(\sigma\)</span>) samples for
several choices of <span class="math inline">\(\sigma&gt;0\)</span> and
check that the mode of the generated samples is close to the theoretical
mode <span class="math inline">\(\sigma\)</span> (check the
histogram).</p>
<p>解答过程: 先对密度积分<span class="math display">\[\int_{0}^{t}\frac{x}{\sigma^2}e^{-\frac{x^2}{2\sigma^2}}dx=-e^{-\frac{x^2}{2\sigma^2}}|_{0,t}=1-e^{-\frac{t^2}{2\sigma^2}}\]</span></p>
<p>因此令<span class="math inline">\(u=1-e^{-\frac{t^2}{2\sigma^2}}\)</span>反解出<span class="math inline">\(x=\sqrt{-2\sigma^2ln(1-u)}\)</span>，令u服从(0,1)上均匀分布即可构造出服从Rayleigh(<span class="math inline">\(\sigma\)</span>)分布的样本：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># 每个σ生成1000个样本</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>sample1 <span class="ot">&lt;-</span> sigma[<span class="dv">1</span>] <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">runif</span>(n)))</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>sample2 <span class="ot">&lt;-</span> sigma[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">runif</span>(n)))</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>sample3 <span class="ot">&lt;-</span> sigma[<span class="dv">3</span>] <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">runif</span>(n)))</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">hist</span>(sample1, <span class="at">breaks =</span> <span class="dv">50</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;sigma =&quot;</span>, sigma[<span class="dv">1</span>]), <span class="at">probability =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>generated_samples <span class="ot">&lt;-</span> <span class="fu">density</span>(sample1)<span class="sc">$</span>x[<span class="fu">which.max</span>(<span class="fu">density</span>(sample1)<span class="sc">$</span>y)]</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;众数是&quot;</span>,generated_samples,<span class="st">&quot;此时的sigma是&quot;</span>,sigma[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## 众数是 1.275881 此时的sigma是 1</code></pre>
<p>类似的还能对不同的sigma进行数据模拟:</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<pre><code>## 众数是 2.499344 此时的sigma是 2</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<pre><code>## 众数是 3.333107 此时的sigma是 3</code></pre>
<p>从上述代码中可以发现众数跟真值<span class="math inline">\(\sigma\)</span>比较接近</p>
</div>
<div id="section" class="section level2">
<h2>3.11</h2>
<p>Generate a random sample of size 1000 from a normal location mixture.
The components of the mixture have N(0,1) and N(3,1) distributions with
mixing probabilities p1 and <span class="math inline">\(p_2 =1−
p_1\)</span>. Graph the histogram of the sample with density
superimposed, for <span class="math inline">\(p_1 =0.75\)</span>. Repeat
with different values for <span class="math inline">\(p_1\)</span> and
observe whether the empirical distribution of the mixture appears to be
bimodal. Make a conjecture about the values of <span class="math inline">\(p_1\)</span> that produce bimodal mixtures.</p>
<p>解答过程：</p>
<p>p1 = 0.5时</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> p)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>k)<span class="sc">*</span>x1 <span class="sc">+</span> k<span class="sc">*</span>x2</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">&quot;Histogram of mixture&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(x), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>p1 = 0.3时</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> p)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>k)<span class="sc">*</span>x1 <span class="sc">+</span> k<span class="sc">*</span>x2</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">&quot;Histogram of mixture&quot;</span>,</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(x), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>p1 = 0.75时</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.25</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> p)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>k)<span class="sc">*</span>x1 <span class="sc">+</span> k<span class="sc">*</span>x2</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">hist</span>(x, <span class="at">probability =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">&quot;Histogram of mixture&quot;</span>,</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(x), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>发现随着p1从0.5开始逐渐变小或者变大，峰从双峰逐渐变成单峰，这是因为此时两个正态分布中有一个逐渐占主导地位，因此在p1
= 0.5时双峰最明显，在p1靠近0或者1时逐渐变成单峰</p>
</div>
<div id="section-1" class="section level2">
<h2>3.14</h2>
<p>A compound Poisson process is a stochastic process <span class="math inline">\(\{X(t), t \geq 0\}\)</span> that can be
represented as the random sum <span class="math display">\[
X(t) = \sum_{i=1}^{N(t)} Y_i, \quad t \geq 0,
\]</span> where <span class="math inline">\(\{N(t), t \geq 0\}\)</span>
is a Poisson process and <span class="math inline">\(Y_1, Y_2,
\dots\)</span> are iid and independent of <span class="math inline">\(\{N(t), t \geq 0\}\)</span>. Write a program to
simulate a compound Poisson <span class="math inline">\((\lambda)\)</span>–Gamma process (Y has a Gamma
distribution). Estimate the mean and the variance of <span class="math inline">\(X(10)\)</span> for several choices of the
parameters and compare with the theoretical values.</p>
<p>Hint: Show that <span class="math display">\[
E[X(t)] = \lambda t E[Y_1] \quad \text{and} \quad \text{Var}(X(t)) =
\lambda t E[Y_1^2].
\]</span></p>
<p>解答过程：Gamma分布参数为(1,1)，泊松分布参数<span class="math inline">\(\lambda=1\)</span>时：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># 设定参数</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># 泊松过程的强度参数</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="dv">1</span>   </span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>rate <span class="ot">&lt;-</span> <span class="dv">1</span>    <span class="co"># Gamma分布的两个参数</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">10</span>      <span class="co"># 观察时间</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># 定义复合泊松-伽马过程的模拟函数</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>compound_poisson_gamma <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, shape, rate, t) {</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  <span class="co"># 泊松过程：确定给定时间t的事件数</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  N_t <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda <span class="sc">*</span> t)</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>  <span class="co"># 如果事件数为0，返回0，否则生成Gamma随机变量</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>  <span class="cf">if</span> (N_t <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(N_t, <span class="at">shape =</span> shape, <span class="at">rate =</span> rate)  <span class="co"># 生成N_t个Gamma随机变量</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(Y))  <span class="co"># 返回随机和</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>  }</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>}</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co"># 模拟过程</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 模拟次数</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>X_10 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, <span class="fu">compound_poisson_gamma</span>(lambda, shape, rate, t))</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co"># 计算样本均值和方差</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>mean_X_10 <span class="ot">&lt;-</span> <span class="fu">mean</span>(X_10)</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>var_X_10 <span class="ot">&lt;-</span> <span class="fu">var</span>(X_10)</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co"># 理论均值和方差</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>theoretical_mean <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> (shape <span class="sc">/</span> rate)</span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>theoretical_variance <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> ((shape <span class="sc">/</span> rate<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (shape<span class="sc">/</span>rate)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sample mean of X(10):&quot;</span>, mean_X_10, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sample mean of X(10): 10.0062</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sample variance of X(10):&quot;</span>, var_X_10, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sample variance of X(10): 19.84671</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Theoretical mean of X(10):&quot;</span>, theoretical_mean, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Theoretical mean of X(10): 10</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Theoretical variance of X(10):&quot;</span>, theoretical_variance, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Theoretical variance of X(10): 20</code></pre>
<p>Gamma分布参数为(2,2)，泊松分布参数<span class="math inline">\(\lambda=1\)</span>时：</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># 设定参数</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># 泊松过程的强度参数</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="dv">2</span>   </span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>rate <span class="ot">&lt;-</span> <span class="dv">2</span>    <span class="co"># Gamma分布的两个参数</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">10</span>      <span class="co"># 观察时间</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co"># 定义复合泊松-伽马过程的模拟函数</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>compound_poisson_gamma <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, shape, rate, t) {</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="co"># 泊松过程：确定给定时间t的事件数</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  N_t <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda <span class="sc">*</span> t)</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  </span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  <span class="co"># 如果事件数为0，返回0，否则生成Gamma随机变量</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>  <span class="cf">if</span> (N_t <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(N_t, <span class="at">shape =</span> shape, <span class="at">rate =</span> rate)  <span class="co"># 生成N_t个Gamma随机变量</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(Y))  <span class="co"># 返回随机和</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  }</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>}</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co"># 模拟过程</span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 模拟次数</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>X_10 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, <span class="fu">compound_poisson_gamma</span>(lambda, shape, rate, t))</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="co"># 计算样本均值和方差</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>mean_X_10 <span class="ot">&lt;-</span> <span class="fu">mean</span>(X_10)</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>var_X_10 <span class="ot">&lt;-</span> <span class="fu">var</span>(X_10)</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co"># 理论均值和方差</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a>theoretical_mean <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> (shape <span class="sc">/</span> rate)</span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a>theoretical_variance <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> ((shape <span class="sc">/</span> rate<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (shape<span class="sc">/</span>rate)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sample mean of X(10):&quot;</span>, mean_X_10, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sample mean of X(10): 9.99486</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sample variance of X(10):&quot;</span>, var_X_10, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sample variance of X(10): 15.48726</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Theoretical mean of X(10):&quot;</span>, theoretical_mean, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Theoretical mean of X(10): 10</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Theoretical variance of X(10):&quot;</span>, theoretical_variance, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Theoretical variance of X(10): 15</code></pre>
<p>Gamma分布参数为(2,2)，泊松分布参数<span class="math inline">\(\lambda=2\)</span>时：</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># 设定参数</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">2</span>  <span class="co"># 泊松过程的强度参数</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="dv">2</span>   </span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>rate <span class="ot">&lt;-</span> <span class="dv">2</span>    <span class="co"># Gamma分布的两个参数</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">10</span>      <span class="co"># 观察时间</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co"># 定义复合泊松-伽马过程的模拟函数</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>compound_poisson_gamma <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, shape, rate, t) {</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>  <span class="co"># 泊松过程：确定给定时间t的事件数</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>  N_t <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1</span>, lambda <span class="sc">*</span> t)</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>  </span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  <span class="co"># 如果事件数为0，返回0，否则生成Gamma随机变量</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>  <span class="cf">if</span> (N_t <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>    Y <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(N_t, <span class="at">shape =</span> shape, <span class="at">rate =</span> rate)  <span class="co"># 生成N_t个Gamma随机变量</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(Y))  <span class="co"># 返回随机和</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>  }</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>}</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="co"># 模拟过程</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>n_simulations <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 模拟次数</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>X_10 <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_simulations, <span class="fu">compound_poisson_gamma</span>(lambda, shape, rate, t))</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a><span class="co"># 计算样本均值和方差</span></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>mean_X_10 <span class="ot">&lt;-</span> <span class="fu">mean</span>(X_10)</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>var_X_10 <span class="ot">&lt;-</span> <span class="fu">var</span>(X_10)</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a><span class="co"># 理论均值和方差</span></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>theoretical_mean <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> (shape <span class="sc">/</span> rate)</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>theoretical_variance <span class="ot">&lt;-</span> lambda <span class="sc">*</span> t <span class="sc">*</span> ((shape <span class="sc">/</span> rate<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (shape<span class="sc">/</span>rate)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a></span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sample mean of X(10):&quot;</span>, mean_X_10, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sample mean of X(10): 19.99826</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Sample variance of X(10):&quot;</span>, var_X_10, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Sample variance of X(10): 30.30163</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Theoretical mean of X(10):&quot;</span>, theoretical_mean, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Theoretical mean of X(10): 20</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Theoretical variance of X(10):&quot;</span>, theoretical_variance, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Theoretical variance of X(10): 30</code></pre>
<p>可以发现在无论参数如何变化，<span class="math inline">\(X(10)\)</span>的理论均值和方差均与实验模拟的均值和方差接近</p>
</div>
</div>
<div id="第二次作业" class="section level1">
<h1>第二次作业</h1>
<div id="section-2" class="section level2">
<h2>5.4</h2>
<p>Write a function to compute a Monte Carlo estimate of the <span class="math inline">\(Beta(3, 3)\)</span> cdf, and use the function to
estimate <span class="math inline">\(F(x)\)</span> for<span class="math inline">\(x =0.1,0.2,...,0.9\)</span>. Compare the estimates
with the values returned by the pbeta function in R.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="co"># 使用接受拒绝法生成 n 个服从 Beta(3,3) 分布的样本</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>accept_reject_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="co"># 初始化接受的样本集合</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  accepted_samples <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>  </span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>  <span class="co"># Beta(3,3) 的目标密度函数（未归一化）</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a>  target_density <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>    <span class="fu">return</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  }</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>  </span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>  <span class="co"># 设定常数 c (选择较大的 c 可以提高接受概率)</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>  c <span class="ot">&lt;-</span> <span class="fl">1.5</span>  <span class="co"># 因为 Beta(3,3) 的最大密度值约为 1.5</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>  </span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>  <span class="co"># 计数已接受的样本数</span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>  count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a>  </span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a>  <span class="co"># 开始接受拒绝过程</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>  <span class="cf">while</span> (count <span class="sc">&lt;</span> n) {</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>    <span class="co"># 从均匀分布 U(0,1) 中生成候选样本</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a>    x_candidate <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>    </span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a>    <span class="co"># 生成一个 U(0, 1) 的随机数作为接受标准</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a>    u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a>    </span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>    <span class="co"># 根据接受概率决定是否接受候选样本</span></span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>    <span class="cf">if</span> (u <span class="sc">&lt;=</span> <span class="fu">target_density</span>(x_candidate) <span class="sc">/</span> c) {</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>      <span class="co"># 接受该候选样本</span></span>
<span id="cb33-29"><a href="#cb33-29" tabindex="-1"></a>      count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb33-30"><a href="#cb33-30" tabindex="-1"></a>      accepted_samples[count] <span class="ot">&lt;-</span> x_candidate</span>
<span id="cb33-31"><a href="#cb33-31" tabindex="-1"></a>    }</span>
<span id="cb33-32"><a href="#cb33-32" tabindex="-1"></a>  }</span>
<span id="cb33-33"><a href="#cb33-33" tabindex="-1"></a>  </span>
<span id="cb33-34"><a href="#cb33-34" tabindex="-1"></a>  <span class="fu">return</span>(accepted_samples)</span>
<span id="cb33-35"><a href="#cb33-35" tabindex="-1"></a>}</span>
<span id="cb33-36"><a href="#cb33-36" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" tabindex="-1"></a><span class="co"># 定义蒙特卡洛估计函数，使用接受拒绝法生成 Beta(3,3) 样本</span></span>
<span id="cb33-38"><a href="#cb33-38" tabindex="-1"></a>monte_carlo_beta_cdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">n =</span> <span class="dv">100000</span>) {</span>
<span id="cb33-39"><a href="#cb33-39" tabindex="-1"></a>  <span class="co"># 使用接受拒绝法生成 n 个 Beta(3, 3) 分布的随机样本</span></span>
<span id="cb33-40"><a href="#cb33-40" tabindex="-1"></a>  samples <span class="ot">&lt;-</span> <span class="fu">accept_reject_beta</span>(n)</span>
<span id="cb33-41"><a href="#cb33-41" tabindex="-1"></a>  <span class="co"># 计算 F(x) = P(X &lt;= x)，使用向量化比较</span></span>
<span id="cb33-42"><a href="#cb33-42" tabindex="-1"></a>  cdf_estimates <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(<span class="fu">outer</span>(samples, x, <span class="st">&quot;&lt;=&quot;</span>))</span>
<span id="cb33-43"><a href="#cb33-43" tabindex="-1"></a>  <span class="fu">return</span>(cdf_estimates)</span>
<span id="cb33-44"><a href="#cb33-44" tabindex="-1"></a>}</span>
<span id="cb33-45"><a href="#cb33-45" tabindex="-1"></a></span>
<span id="cb33-46"><a href="#cb33-46" tabindex="-1"></a><span class="co"># 给定的 x 值</span></span>
<span id="cb33-47"><a href="#cb33-47" tabindex="-1"></a>x_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb33-48"><a href="#cb33-48" tabindex="-1"></a></span>
<span id="cb33-49"><a href="#cb33-49" tabindex="-1"></a><span class="co"># 使用蒙特卡洛方法计算 CDF</span></span>
<span id="cb33-50"><a href="#cb33-50" tabindex="-1"></a>monte_carlo_estimates <span class="ot">&lt;-</span> <span class="fu">monte_carlo_beta_cdf</span>(x_values)</span>
<span id="cb33-51"><a href="#cb33-51" tabindex="-1"></a></span>
<span id="cb33-52"><a href="#cb33-52" tabindex="-1"></a><span class="co"># 使用 R 自带的 pbeta 函数计算真实的 CDF</span></span>
<span id="cb33-53"><a href="#cb33-53" tabindex="-1"></a>pbeta_estimates <span class="ot">&lt;-</span> <span class="fu">pbeta</span>(x_values, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb33-54"><a href="#cb33-54" tabindex="-1"></a></span>
<span id="cb33-55"><a href="#cb33-55" tabindex="-1"></a><span class="co"># 打印结果并比较</span></span>
<span id="cb33-56"><a href="#cb33-56" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_values, </span>
<span id="cb33-57"><a href="#cb33-57" tabindex="-1"></a>                      <span class="at">MonteCarlo =</span> monte_carlo_estimates, </span>
<span id="cb33-58"><a href="#cb33-58" tabindex="-1"></a>                      <span class="at">pbeta =</span> pbeta_estimates)</span>
<span id="cb33-59"><a href="#cb33-59" tabindex="-1"></a></span>
<span id="cb33-60"><a href="#cb33-60" tabindex="-1"></a><span class="fu">print</span>(results)</span></code></pre></div>
<pre><code>##     x MonteCarlo   pbeta
## 1 0.1    0.00781 0.00856
## 2 0.2    0.05702 0.05792
## 3 0.3    0.16251 0.16308
## 4 0.4    0.31740 0.31744
## 5 0.5    0.50171 0.50000
## 6 0.6    0.68351 0.68256
## 7 0.7    0.83781 0.83692
## 8 0.8    0.94251 0.94208
## 9 0.9    0.99158 0.99144</code></pre>
<p>可以从表中看出估计的cdf与真值比较接近，实际上在样本量趋于无穷时估计是相合的</p>
</div>
<div id="section-3" class="section level2">
<h2>5.9</h2>
<p>The Rayleigh density [156, (18.76)] is given by</p>
<p><span class="math display">\[ f(x) = \frac{x}{\sigma^2}
e^{-\frac{x^2}{2\sigma^2}}, \quad x \geq 0, \sigma &gt; 0.\]</span></p>
<p>Implement a function to generate samples from a <span class="math inline">\(Rayleigh(\sigma)\)</span> distribution using
antithetic variables. What is the percent reduction in variance of <span class="math inline">\(\frac{X + X&#39;}{2}\)</span> compared with <span class="math inline">\(\frac{X_1 + X_2}{2}\)</span> for independent <span class="math inline">\((X_1, X_2)\)</span>?</p>
<p>为了生成 Rayleigh 分布的样本,我们先生成均匀分布随机变量<span class="math inline">\(U\sim
U(0,1)\)</span>，再通过反函数生成Rayleigh分布样本：$X= $</p>
<p>对偶变量的使用可以通过生成一个补充的随机变量<span class="math inline">\(U&#39;=1-U\)</span>，然后生成对应的Rayleigh分布样本$X=
$</p>
<p>最后计算方差减少的百分比:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="co"># 设置Rayleigh分布的sigma参数</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="co"># 设置样本数量</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="co"># 生成n个独立的Rayleigh分布样本</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>U1 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)  <span class="co"># 生成均匀分布的随机变量</span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a>U2 <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)  <span class="co"># 生成另一个独立的均匀分布随机变量</span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(U1))  <span class="co"># 生成第一个Rayleigh样本</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(U2))  <span class="co"># 生成第二个独立Rayleigh样本</span></span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a><span class="co"># 使用对偶变量生成n个Rayleigh分布样本</span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">runif</span>(n)  <span class="co"># 生成均匀分布的随机变量</span></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>U_prime <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> U  <span class="co"># 对偶变量</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>X <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(U))  <span class="co"># 生成Rayleigh样本</span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>X_prime <span class="ot">&lt;-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(U_prime))  <span class="co"># 生成对偶的Rayleigh样本</span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="co"># 生成独立变量样本和对偶变量样本</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a>independent_samples <span class="ot">&lt;-</span> (X1 <span class="sc">+</span> X2) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a>antithetic_samples <span class="ot">&lt;-</span> (X <span class="sc">+</span> X_prime) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a>  </span>
<span id="cb35-25"><a href="#cb35-25" tabindex="-1"></a><span class="co"># 计算独立变量的方差和对偶变量的方差</span></span>
<span id="cb35-26"><a href="#cb35-26" tabindex="-1"></a>var_independent <span class="ot">&lt;-</span> <span class="fu">var</span>(independent_samples)</span>
<span id="cb35-27"><a href="#cb35-27" tabindex="-1"></a>var_antithetic <span class="ot">&lt;-</span> <span class="fu">var</span>(antithetic_samples)</span>
<span id="cb35-28"><a href="#cb35-28" tabindex="-1"></a>  </span>
<span id="cb35-29"><a href="#cb35-29" tabindex="-1"></a><span class="co"># 计算方差减少的百分比</span></span>
<span id="cb35-30"><a href="#cb35-30" tabindex="-1"></a>reduction_percent <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">*</span> (var_independent <span class="sc">-</span> var_antithetic) <span class="sc">/</span> var_independent</span>
<span id="cb35-31"><a href="#cb35-31" tabindex="-1"></a></span>
<span id="cb35-32"><a href="#cb35-32" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;方差减少的百分比:&quot;</span>, reduction_percent, <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 方差减少的百分比: 94.83453 %</code></pre>
<p>可以看出方差确实降低很多</p>
</div>
<div id="section-4" class="section level2">
<h2>5.13</h2>
<p>Find two importance functions <span class="math inline">\(f_1\)</span> and <span class="math inline">\(f_2\)</span> that are supported on <span class="math inline">\((1, \infty)\)</span> and are ‘close’ to <span class="math display">\[
g(x) = \frac{x^2}{\sqrt{2\pi}} e^{-x^2/2}, \quad x &gt; 1.
\]</span> Which of your two importance functions should produce the
smaller variance in estimating <span class="math display">\[
\int_{1}^{\infty} \frac{x^2}{\sqrt{2\pi}} e^{-x^2/2} \, dx
\]</span> by importance sampling? Explain.</p>
<p>令 <span class="math inline">\(f_1(x) = c_1x e^{-x^2/2}, \quad x &gt;
1\)</span></p>
<p>其中<span class="math inline">\(c_1\)</span>为归一化参数,<span class="math inline">\(c_1=1/\int_{1}^{+\infty}xe^{-\frac{x^2}{2}}dx=1.6487\)</span>，保留四位小数</p>
<p>再令 <span class="math inline">\(f_2(x) = c_2 e^{-x},\quad
x&gt;1\)</span>，同样<span class="math inline">\(c_2\)</span>是归一化常数，<span class="math inline">\(c_2=e=2.7183\)</span></p>
<p>我们注意到重要性函数越接近目标分布，方差越小。因此我们预测<span class="math inline">\(f_1(x) = c_1x e^{-x^2/2}, \quad x &gt; 1\)</span>
将会产生较小的方差。</p>
<p>最后，我们进行实验验证猜测：</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fl">1.6487</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fl">2.7183</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a><span class="co"># 从重要性函数 f1 和 f2中抽样</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>samples1 <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span>)<span class="sc">-</span>u<span class="sc">/</span>c1)))</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>}</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" tabindex="-1"></a>samples2 <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb37-13"><a href="#cb37-13" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb37-14"><a href="#cb37-14" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>u))</span>
<span id="cb37-15"><a href="#cb37-15" tabindex="-1"></a>}</span>
<span id="cb37-16"><a href="#cb37-16" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" tabindex="-1"></a><span class="co"># 生成样本</span></span>
<span id="cb37-18"><a href="#cb37-18" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 样本数量</span></span>
<span id="cb37-19"><a href="#cb37-19" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" tabindex="-1"></a><span class="co"># 从 f1 生成样本</span></span>
<span id="cb37-21"><a href="#cb37-21" tabindex="-1"></a>samples_f1 <span class="ot">&lt;-</span> <span class="fu">samples1</span>(n) </span>
<span id="cb37-22"><a href="#cb37-22" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" tabindex="-1"></a><span class="co"># 从 f2 生成样本</span></span>
<span id="cb37-24"><a href="#cb37-24" tabindex="-1"></a>samples_f2 <span class="ot">&lt;-</span> <span class="fu">samples2</span>(n) </span>
<span id="cb37-25"><a href="#cb37-25" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" tabindex="-1"></a><span class="co"># 计算重要性权重</span></span>
<span id="cb37-27"><a href="#cb37-27" tabindex="-1"></a>weights_f1 <span class="ot">&lt;-</span> samples_f1<span class="sc">*</span>c1<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi)  <span class="co"># 计算 f1 的权重</span></span>
<span id="cb37-28"><a href="#cb37-28" tabindex="-1"></a>weights_f2 <span class="ot">&lt;-</span> samples_f2<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span>pi)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>samples_f2<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">exp</span>(<span class="sc">-</span>samples_f2)  <span class="co"># 计算 f2 的权重</span></span>
<span id="cb37-29"><a href="#cb37-29" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" tabindex="-1"></a><span class="co"># 计算期望估计</span></span>
<span id="cb37-31"><a href="#cb37-31" tabindex="-1"></a>estimate_f1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(weights_f1)</span>
<span id="cb37-32"><a href="#cb37-32" tabindex="-1"></a>estimate_f2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(weights_f2)</span>
<span id="cb37-33"><a href="#cb37-33" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" tabindex="-1"></a><span class="co"># 计算方差</span></span>
<span id="cb37-35"><a href="#cb37-35" tabindex="-1"></a>variance_f1 <span class="ot">&lt;-</span> <span class="fu">var</span>(weights_f1)</span>
<span id="cb37-36"><a href="#cb37-36" tabindex="-1"></a>variance_f2 <span class="ot">&lt;-</span> <span class="fu">var</span>(weights_f2)</span>
<span id="cb37-37"><a href="#cb37-37" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb37-39"><a href="#cb37-39" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;估计值 f1:&quot;</span>, estimate_f1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 估计值 f1: 1.090849</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;估计值 f2:&quot;</span>, estimate_f2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 估计值 f2: 1.089945</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;方差 f1:&quot;</span>, variance_f1, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 方差 f1: 0.1139113</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;方差 f2:&quot;</span>, variance_f2, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 方差 f2: 0.1844155</code></pre>
<p>可以发现确实方法1的方差小一些</p>
</div>
<div id="monte-carlo-experiment" class="section level2">
<h2>Monte Carlo experiment</h2>
<ul>
<li>For <span class="math inline">\(n =
104,2×104,4×104,6×104,8×104\)</span>, apply the fast sorting algorithm
to randomly permuted numbers of 1,…,n.</li>
<li>Calculate computation time averaged over 100 simulations, denoted by
<span class="math inline">\(a_n\)</span>.</li>
<li>Regress an on <span class="math inline">\(t_n := nlog(n)\)</span>,
and graphically show the results (scatter plot and regression line)</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co"># 快速排序函数</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>quick_sort <span class="ot">&lt;-</span> <span class="cf">function</span>(arr) {</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(arr) <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>    <span class="fu">return</span>(arr)</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>    pivot <span class="ot">&lt;-</span> arr[<span class="dv">1</span>]  <span class="co"># 基准</span></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>    left <span class="ot">&lt;-</span> arr[arr <span class="sc">&lt;</span> pivot]  <span class="co"># 左边部分</span></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>    right <span class="ot">&lt;-</span> arr[arr <span class="sc">&gt;</span> pivot]  <span class="co"># 右边部分</span></span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>    middle <span class="ot">&lt;-</span> arr[arr <span class="sc">==</span> pivot]  <span class="co"># 相等部分</span></span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">quick_sort</span>(left), middle, <span class="fu">quick_sort</span>(right)))</span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>  }</span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>}</span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a><span class="co"># 进行 Monte Carlo 实验</span></span>
<span id="cb45-15"><a href="#cb45-15" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># 为了结果可重复</span></span>
<span id="cb45-16"><a href="#cb45-16" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" tabindex="-1"></a><span class="co"># 定义 n 的取值</span></span>
<span id="cb45-18"><a href="#cb45-18" tabindex="-1"></a>n_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>, <span class="dv">2</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>, <span class="dv">4</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>, <span class="dv">6</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>, <span class="dv">8</span><span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>)</span>
<span id="cb45-19"><a href="#cb45-19" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" tabindex="-1"></a><span class="co"># 保存平均时间的向量</span></span>
<span id="cb45-21"><a href="#cb45-21" tabindex="-1"></a>avg_times <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb45-22"><a href="#cb45-22" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" tabindex="-1"></a><span class="co"># 对每个 n 进行 100 次排序</span></span>
<span id="cb45-24"><a href="#cb45-24" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> n_values) {</span>
<span id="cb45-25"><a href="#cb45-25" tabindex="-1"></a>  times <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)  <span class="co"># 保存100次排序时间</span></span>
<span id="cb45-26"><a href="#cb45-26" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb45-27"><a href="#cb45-27" tabindex="-1"></a>    random_numbers <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n)  <span class="co"># 生成随机排列的数字</span></span>
<span id="cb45-28"><a href="#cb45-28" tabindex="-1"></a>    start_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()  <span class="co"># 开始时间</span></span>
<span id="cb45-29"><a href="#cb45-29" tabindex="-1"></a>    sorted_numbers <span class="ot">&lt;-</span> <span class="fu">quick_sort</span>(random_numbers)  <span class="co"># 快速排序</span></span>
<span id="cb45-30"><a href="#cb45-30" tabindex="-1"></a>    end_time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()  <span class="co"># 结束时间</span></span>
<span id="cb45-31"><a href="#cb45-31" tabindex="-1"></a>    times[i] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(end_time <span class="sc">-</span> start_time, <span class="at">units =</span> <span class="st">&quot;secs&quot;</span>)  <span class="co"># 计算排序耗时</span></span>
<span id="cb45-32"><a href="#cb45-32" tabindex="-1"></a>  }</span>
<span id="cb45-33"><a href="#cb45-33" tabindex="-1"></a>  avg_times <span class="ot">&lt;-</span> <span class="fu">c</span>(avg_times, <span class="fu">mean</span>(times))  <span class="co"># 计算平均时间</span></span>
<span id="cb45-34"><a href="#cb45-34" tabindex="-1"></a>}</span>
<span id="cb45-35"><a href="#cb45-35" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" tabindex="-1"></a><span class="co"># 将 n 和 log(n) 结合起来</span></span>
<span id="cb45-37"><a href="#cb45-37" tabindex="-1"></a>log_n <span class="ot">&lt;-</span> n_values <span class="sc">*</span> <span class="fu">log</span>(n_values)</span>
<span id="cb45-38"><a href="#cb45-38" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" tabindex="-1"></a><span class="co"># 进行回归分析</span></span>
<span id="cb45-40"><a href="#cb45-40" tabindex="-1"></a>regression <span class="ot">&lt;-</span> <span class="fu">lm</span>(avg_times <span class="sc">~</span> log_n)</span>
<span id="cb45-41"><a href="#cb45-41" tabindex="-1"></a></span>
<span id="cb45-42"><a href="#cb45-42" tabindex="-1"></a><span class="co"># 可视化回归结果</span></span>
<span id="cb45-43"><a href="#cb45-43" tabindex="-1"></a><span class="fu">plot</span>(log_n, avg_times, <span class="at">main =</span> <span class="st">&quot;Regression of Sorting Time on n log(n)&quot;</span>,</span>
<span id="cb45-44"><a href="#cb45-44" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;n log(n)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Average Sorting Time (seconds)&quot;</span>,</span>
<span id="cb45-45"><a href="#cb45-45" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb45-46"><a href="#cb45-46" tabindex="-1"></a><span class="fu">abline</span>(regression, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>观察回归结果发现时间大概是O(nlog(n))级别</p>
</div>
</div>
<div id="第三次作业" class="section level1">
<h1>第三次作业</h1>
<div id="section-5" class="section level2">
<h2>6.6</h2>
<p>Estimate the 0.025, 0.05, 0.95, and 0.975 quantiles of the skewness
<span class="math inline">\(\sqrt{b_1}\)</span> under normality by a
Monte Carlo experiment. Compute the standard error of the estimates from
(2.14) using the normal approximation for the density (with exact
variance formula). Compare the estimated quantiles with the quantiles of
the large sample approximation <span class="math inline">\(\sqrt{b_1} ≈
N(0,6/n)\)</span></p>
<p>题目即通过蒙特卡洛实验估计偏度<span class="math inline">\(\sqrt{b_1}\)</span>的分位数（0.025, 0.05, 0.95,
0.975）</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="co"># 设置随机种子以确保结果可重复</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a><span class="co"># 蒙特卡洛实验参数</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># 每次实验的样本大小</span></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 总实验次数</span></span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a><span class="co"># 存储偏度的平方根</span></span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a>skewness_sqrt_b1 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_simulations)</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a><span class="co"># 进行蒙特卡洛实验</span></span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a>  <span class="co"># 生成 n 个正态分布的随机样本</span></span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a>  sample <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a>  </span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a>  <span class="co"># 计算样本偏度</span></span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a>  skewness_b1 <span class="ot">&lt;-</span> <span class="fu">sum</span>((sample <span class="sc">-</span> <span class="fu">mean</span>(sample))<span class="sc">^</span><span class="dv">3</span>) <span class="sc">/</span> ((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sd</span>(sample)<span class="sc">^</span><span class="dv">3</span>)</span>
<span id="cb46-18"><a href="#cb46-18" tabindex="-1"></a>  </span>
<span id="cb46-19"><a href="#cb46-19" tabindex="-1"></a>  <span class="co"># 计算偏度的平方根并存储</span></span>
<span id="cb46-20"><a href="#cb46-20" tabindex="-1"></a>  skewness_sqrt_b1[i] <span class="ot">&lt;-</span> skewness_b1</span>
<span id="cb46-21"><a href="#cb46-21" tabindex="-1"></a>}</span>
<span id="cb46-22"><a href="#cb46-22" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" tabindex="-1"></a><span class="co"># 计算所需的分位数</span></span>
<span id="cb46-24"><a href="#cb46-24" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(skewness_sqrt_b1, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>))</span>
<span id="cb46-25"><a href="#cb46-25" tabindex="-1"></a><span class="fu">print</span>(quantiles)</span></code></pre></div>
<pre><code>##       2.5%         5%        95%      97.5% 
## -0.1500782 -0.1277768  0.1294921  0.1542565</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a><span class="co"># 计算标准误差</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>q_probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>)</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>standard_errors <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(q_probs <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> q_probs) <span class="sc">/</span> (n <span class="sc">*</span> <span class="fu">dnorm</span>(<span class="fu">qnorm</span>(q_probs))<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a><span class="fu">print</span>(standard_errors)</span></code></pre></div>
<pre><code>## [1] 0.08447427 0.06682486 0.06682486 0.08447427</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="co"># 估计的标准差与正态分布近似的分位数</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>estimated_quantiles <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(q_probs, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">6</span><span class="sc">/</span>n))</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a><span class="fu">print</span>(estimated_quantiles)</span></code></pre></div>
<pre><code>## [1] -0.1518182 -0.1274098  0.1274098  0.1518182</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="co"># 比较结果</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Quantiles =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.975</span>),</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>                         <span class="at">Monte_Carlo =</span> quantiles,</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>                         <span class="at">Standard_Error =</span> standard_errors,</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>                         <span class="at">Normal_Approximation =</span> estimated_quantiles)</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a><span class="fu">print</span>(comparison)</span></code></pre></div>
<pre><code>##       Quantiles Monte_Carlo Standard_Error Normal_Approximation
## 2.5%      0.025  -0.1500782     0.08447427           -0.1518182
## 5%        0.050  -0.1277768     0.06682486           -0.1274098
## 95%       0.950   0.1294921     0.06682486            0.1274098
## 97.5%     0.975   0.1542565     0.08447427            0.1518182</code></pre>
</div>
<div id="b" class="section level2">
<h2>6.B</h2>
<p>Tests for association based on Pearson product moment correlation
<span class="math inline">\(\rho\)</span>,Spearman’s rank correlation
coefficient ρs, or Kendall’s coefficient <span class="math inline">\(\tau\)</span>, are implemented in cor.test. Show
(empirically) that the nonparametric tests based on <span class="math inline">\(\rho_s\)</span> or <span class="math inline">\(\tau\)</span> are less powerful than the
correlation test when the sampled distribution is bivariate normal. Find
an example of an alternative (a bivariate distribution (X,Y) such that X
and Y are dependent) such that at least one of the nonparametric tests
have better empirical power than the correlation test against this
alternative.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># 设置随机种子以便重现</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a><span class="co"># 设定参数</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># 样本大小</span></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>num_simulations <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># 模拟次数</span></span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a><span class="co"># 正态分布数据</span></span>
<span id="cb54-9"><a href="#cb54-9" tabindex="-1"></a>pearson_results <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_simulations)</span>
<span id="cb54-10"><a href="#cb54-10" tabindex="-1"></a>spearman_results <span class="ot">&lt;-</span> <span class="fu">numeric</span>(num_simulations)</span>
<span id="cb54-11"><a href="#cb54-11" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_simulations) {</span>
<span id="cb54-13"><a href="#cb54-13" tabindex="-1"></a>  <span class="co"># 生成双变量正态分布数据</span></span>
<span id="cb54-14"><a href="#cb54-14" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb54-15"><a href="#cb54-15" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rt</span>(n, <span class="at">df =</span> <span class="dv">1</span>)  <span class="co"># 让x和y相关，且相关性不高</span></span>
<span id="cb54-16"><a href="#cb54-16" tabindex="-1"></a>  <span class="co"># 皮尔逊检验</span></span>
<span id="cb54-17"><a href="#cb54-17" tabindex="-1"></a>  pearson_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x, y)</span>
<span id="cb54-18"><a href="#cb54-18" tabindex="-1"></a>  pearson_results[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pearson_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb54-19"><a href="#cb54-19" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" tabindex="-1"></a>  <span class="co"># 斯皮尔曼检验</span></span>
<span id="cb54-21"><a href="#cb54-21" tabindex="-1"></a>  spearman_test <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb54-22"><a href="#cb54-22" tabindex="-1"></a>  spearman_results[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(spearman_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb54-23"><a href="#cb54-23" tabindex="-1"></a>}</span>
<span id="cb54-24"><a href="#cb54-24" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" tabindex="-1"></a><span class="co"># 计算功效</span></span>
<span id="cb54-26"><a href="#cb54-26" tabindex="-1"></a>pearson_power <span class="ot">&lt;-</span> <span class="fu">mean</span>(pearson_results)</span>
<span id="cb54-27"><a href="#cb54-27" tabindex="-1"></a>spearman_power <span class="ot">&lt;-</span> <span class="fu">mean</span>(spearman_results)</span>
<span id="cb54-28"><a href="#cb54-28" tabindex="-1"></a></span>
<span id="cb54-29"><a href="#cb54-29" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Bivariate Normal Distribution:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Bivariate Normal Distribution:</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Pearson Power:&quot;</span>, pearson_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Pearson Power: 0.033</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Spearman Power:&quot;</span>, spearman_power, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Spearman Power: 0.115</code></pre>
<p>可以发现在x取0~1上均匀分布，y取<span class="math inline">\(x/2\)</span>加上一个<span class="math inline">\(t_1\)</span>分布时，Spearman检验的效能高于Pearson检验</p>
</div>
<div id="补充问题" class="section level2">
<h2>补充问题</h2>
<p>If we obtain the powers for two methods under a particular simulation
setting with 10,000 experiments: say, 0.651 for one method and 0.676 for
another method. We want to know if the powers are different at 0.05
level.</p>
<ul>
<li>What is the corresponding hypothesis test problem?</li>
<li>What test should we use? Z-test, two-sample t-test, paired-t test or
McNemar test? Why?</li>
<li>Please provide the least necessary information for hypothesis
testing</li>
</ul>
<p>零假设: 两个方法的功效相等 <span class="math inline">\(H_0:
p_1=p_2\)</span></p>
<p>对立假设: 两个方法的功效不同 <span class="math inline">\(H_1: p_1\neq
p_2\)</span></p>
<p>在这种情况下，Z检验是最合适的检验方法。这是因为我们是在比较两个独立的比例（两个方法的功效），因此成对t检验和McNemar检验都不合适，同时每个方法的功效估计可以看作是来自大量实验（10,000
次）的样本比例，这符合对比例的正态近似，使用两样本t检验会使检验的功效降低</p>
<p>从题目条件可以看出<span class="math inline">\(n_1=n_2=n=10000\)</span>为每个方法的实验次数，<span class="math inline">\(p_1=0.651\)</span>为方法一的功效，<span class="math inline">\(p_2=0.676\)</span>为方法二的功效。Z统计量可以通过以下公式计算：<span class="math display">\[Z=\frac{p_1-p_2}{SE}\]</span></p>
<p>其中<span class="math inline">\(SE=\sqrt{\frac{p_1(1-p_1)}{n_1}+\frac{p_2(1-p_2)}{n_2}}=0.00668\)</span></p>
<p>则<span class="math inline">\(|Z|=3.7425&gt;1.96\)</span>，因此拒绝原假设，认为两个方法的功效存在显著差异</p>
</div>
</div>
<div id="第四次作业" class="section level1">
<h1>第四次作业</h1>
</div>
<div id="第一题" class="section level1">
<h1>第一题</h1>
<p>Of N =1000 hypotheses, 950 are null and 50 are alternative. The
p-value under any null hypothesis is uniformly distributed (use runif),
and the p-value under any alternative hypothesis follows the beta
distribution with parameter 0.1 and 1 (use rbeta). Obtain Bonferroni
adjusted p-values and B-H adjusted p-values. Calculate FWER, FDR, and
TPR under nominal level α =0.1 for each of the two adjustment methods
based on m=10000 simulation replicates. You should output the 6 numbers
(3 ) to a 3×2 table (column names: Bonferroni correction, B-H
correction; row names: FWER, FDR, TPR). Comment the results.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span>           <span class="co"># 总假设数量</span></span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">10000</span>          <span class="co"># 模拟重复次数</span></span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.1</span>        <span class="co"># 显著性水平</span></span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a><span class="co"># 初始化结果</span></span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a><span class="fu">colnames</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Bonferroni correction&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>)</span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a><span class="fu">rownames</span>(results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;TPR&quot;</span>)</span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" tabindex="-1"></a><span class="co"># 模拟过程</span></span>
<span id="cb60-13"><a href="#cb60-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb60-14"><a href="#cb60-14" tabindex="-1"></a>  <span class="co"># 生成 p-values</span></span>
<span id="cb60-15"><a href="#cb60-15" tabindex="-1"></a>  p_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">runif</span>(<span class="dv">950</span>), <span class="fu">rbeta</span>(<span class="dv">50</span>, <span class="fl">0.1</span>, <span class="dv">1</span>)) </span>
<span id="cb60-16"><a href="#cb60-16" tabindex="-1"></a>  </span>
<span id="cb60-17"><a href="#cb60-17" tabindex="-1"></a>  <span class="co"># 对p值进行两种调整</span></span>
<span id="cb60-18"><a href="#cb60-18" tabindex="-1"></a>  B_H <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_values, <span class="at">method =</span> <span class="st">&quot;BH&quot;</span>)</span>
<span id="cb60-19"><a href="#cb60-19" tabindex="-1"></a>  Bonferroni <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(p_values, <span class="at">method =</span> <span class="st">&quot;bonferroni&quot;</span>)</span>
<span id="cb60-20"><a href="#cb60-20" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" tabindex="-1"></a>  <span class="co"># 计算TP、FP等指标</span></span>
<span id="cb60-22"><a href="#cb60-22" tabindex="-1"></a>  reject_Bonferroni <span class="ot">&lt;-</span> Bonferroni <span class="sc">&lt;</span> alpha</span>
<span id="cb60-23"><a href="#cb60-23" tabindex="-1"></a>  reject_B_H <span class="ot">&lt;-</span> B_H <span class="sc">&lt;</span> alpha</span>
<span id="cb60-24"><a href="#cb60-24" tabindex="-1"></a>  true <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="dv">950</span>), <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="dv">50</span>))   <span class="co"># 标记真实备择假设</span></span>
<span id="cb60-25"><a href="#cb60-25" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" tabindex="-1"></a>  </span>
<span id="cb60-27"><a href="#cb60-27" tabindex="-1"></a>  <span class="co"># 计算FWER</span></span>
<span id="cb60-28"><a href="#cb60-28" tabindex="-1"></a>  FP_Bonferroni <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_Bonferroni <span class="sc">&amp;</span> <span class="sc">!</span>true)     <span class="co"># 错误拒绝次数</span></span>
<span id="cb60-29"><a href="#cb60-29" tabindex="-1"></a>  <span class="cf">if</span>((FP_Bonferroni <span class="sc">&gt;</span> <span class="dv">0</span>)){</span>
<span id="cb60-30"><a href="#cb60-30" tabindex="-1"></a>    results[<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;Bonferroni correction&quot;</span>] <span class="ot">&lt;-</span> results[<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;Bonferroni correction&quot;</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>m</span>
<span id="cb60-31"><a href="#cb60-31" tabindex="-1"></a>  }</span>
<span id="cb60-32"><a href="#cb60-32" tabindex="-1"></a>  FP_B_H <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_B_H <span class="sc">&amp;</span> <span class="sc">!</span>true)</span>
<span id="cb60-33"><a href="#cb60-33" tabindex="-1"></a>  <span class="cf">if</span>(FP_B_H <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb60-34"><a href="#cb60-34" tabindex="-1"></a>    results[<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>] <span class="ot">&lt;-</span> results[<span class="st">&quot;FWER&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>] <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>m</span>
<span id="cb60-35"><a href="#cb60-35" tabindex="-1"></a>  }</span>
<span id="cb60-36"><a href="#cb60-36" tabindex="-1"></a>  </span>
<span id="cb60-37"><a href="#cb60-37" tabindex="-1"></a>  <span class="co"># 计算FDR</span></span>
<span id="cb60-38"><a href="#cb60-38" tabindex="-1"></a>  results[<span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;Bonferroni correction&quot;</span>] <span class="ot">&lt;-</span> results[<span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;Bonferroni correction&quot;</span>] <span class="sc">+</span> (FP_Bonferroni <span class="sc">/</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">sum</span>(reject_Bonferroni)))<span class="sc">/</span>m</span>
<span id="cb60-39"><a href="#cb60-39" tabindex="-1"></a>  results[<span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>] <span class="ot">&lt;-</span> results[<span class="st">&quot;FDR&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>] <span class="sc">+</span> (FP_B_H <span class="sc">/</span> <span class="fu">max</span>(<span class="dv">1</span>, <span class="fu">sum</span>(reject_B_H)))<span class="sc">/</span>m</span>
<span id="cb60-40"><a href="#cb60-40" tabindex="-1"></a>  </span>
<span id="cb60-41"><a href="#cb60-41" tabindex="-1"></a>  <span class="co"># 计算TPR</span></span>
<span id="cb60-42"><a href="#cb60-42" tabindex="-1"></a>  TP_Bonferroni <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_Bonferroni <span class="sc">&amp;</span> true)      <span class="co"># Bonferroni正确拒绝次数</span></span>
<span id="cb60-43"><a href="#cb60-43" tabindex="-1"></a>  TP_B_H <span class="ot">&lt;-</span> <span class="fu">sum</span>(reject_B_H <span class="sc">&amp;</span> true)              <span class="co"># B_H正确拒绝次数</span></span>
<span id="cb60-44"><a href="#cb60-44" tabindex="-1"></a>  results[<span class="st">&quot;TPR&quot;</span>, <span class="st">&quot;Bonferroni correction&quot;</span>] <span class="ot">&lt;-</span> results[<span class="st">&quot;TPR&quot;</span>, <span class="st">&quot;Bonferroni correction&quot;</span>] <span class="sc">+</span> (TP_Bonferroni <span class="sc">/</span> <span class="dv">50</span>)<span class="sc">/</span>m</span>
<span id="cb60-45"><a href="#cb60-45" tabindex="-1"></a>  results[<span class="st">&quot;TPR&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>] <span class="ot">&lt;-</span> results[<span class="st">&quot;TPR&quot;</span>, <span class="st">&quot;B-H correction&quot;</span>] <span class="sc">+</span> (TP_B_H <span class="sc">/</span> <span class="dv">50</span>)<span class="sc">/</span>m</span>
<span id="cb60-46"><a href="#cb60-46" tabindex="-1"></a>}</span>
<span id="cb60-47"><a href="#cb60-47" tabindex="-1"></a></span>
<span id="cb60-48"><a href="#cb60-48" tabindex="-1"></a><span class="fu">print</span>(results)</span></code></pre></div>
<pre><code>##      Bonferroni correction B-H correction
## FWER           0.087300000     0.93050000
## FDR            0.004510088     0.09502215
## TPR            0.396736000     0.56106200</code></pre>
<ul>
<li><p>FWER（Family-Wise Error
Rate）:Bonferroni校正的FWER为0.0873，接近设定的显著性水平0.1。B-H校正的FWER为0.9305，表明它会更宽松地拒绝零假设，因此更容易产生至少一个假阳性。</p></li>
<li><p>FDR（False Discovery
Rate）:Bonferroni校正的FDR极低（0.0045），表明它在控制错误发现率上非常保守。B-H校正的FDR较高（0.095），即使假阳性率高，但它的目标就是控制在指定的错误发现率范围内。</p></li>
<li><p>TPR（True Positive Rate）:
Bonferroni校正的TPR为0.3967，表明它较难检测到真正的效应。B-H校正的TPR为0.561，意味着它能检测到更多的真正效应。</p></li>
</ul>
<p>综合来看，B-H校正更适合在希望保持较高的检出率时使用，而Bonferroni校正则更加保守，适合严格控制假阳性率的场合</p>
</div>
<div id="ex7.4" class="section level1">
<h1>EX7.4</h1>
<p>Refer to the air-conditioning data set aircondit provided in the boot
package. The 12 observations are the times in hours between failures of
air conditioning equipment: <span class="math display">\[3, 5, 7, 18,
43, 85, 91, 98, 100, 130, 230, 487\]</span></p>
<p>Assume the times between failures follow an exponential distribution
<span class="math inline">\(\text{Exp}(\lambda)\)</span>. Obtain the MLE
of the hazard rate λ and use bootstrap to estimate the bias and standard
error of the estimate.</p>
<p>解答：对于一个指数分布 <span class="math inline">\(\text{Exp}(\lambda)\)</span>, 似然函数为:</p>
<p><span class="math display">\[
L(\lambda) = \prod_{i=1}^{n} \lambda e^{-\lambda x_i} = \lambda^n
e^{-\lambda \sum_{i=1}^{n} x_i}
\]</span></p>
<p>将似然函数取对数:</p>
<p><span class="math display">\[
\ell(\lambda) = n \log(\lambda) - \lambda \sum_{i=1}^{n} x_i
\]</span></p>
<p>最大化似然函数可解出 <span class="math inline">\(\lambda\)</span>:</p>
<p><span class="math display">\[
\hat{\lambda} = \frac{n}{\sum_{i=1}^{n} x_i}
\]</span></p>
<p>接下来是代码部分：</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="co"># 加载boot包</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a><span class="co"># 数据集</span></span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" tabindex="-1"></a><span class="co"># 计算最大似然估计MLE</span></span>
<span id="cb62-9"><a href="#cb62-9" tabindex="-1"></a>lambda_mle <span class="ot">&lt;-</span> <span class="fu">length</span>(data) <span class="sc">/</span> <span class="fu">sum</span>(data)</span>
<span id="cb62-10"><a href="#cb62-10" tabindex="-1"></a>lambda_mle</span></code></pre></div>
<pre><code>## [1] 0.00925212</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="co"># 定义一个函数来计算MLE</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>lambda_mle_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, index) {</span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>  sample_data <span class="ot">&lt;-</span> data[index]</span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">length</span>(sample_data) <span class="sc">/</span> <span class="fu">sum</span>(sample_data))</span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>}</span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a><span class="co"># 使用boot函数进行bootstrap抽样，计算偏差和标准差</span></span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">boot</span>(data, lambda_mle_func, <span class="dv">1000</span>)</span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a><span class="co"># 查看bootstrap结果</span></span>
<span id="cb64-11"><a href="#cb64-11" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## 
## ORDINARY NONPARAMETRIC BOOTSTRAP
## 
## 
## Call:
## boot(data = data, statistic = lambda_mle_func, R = 1000)
## 
## 
## Bootstrap Statistics :
##       original     bias    std. error
## t1* 0.00925212 0.00151119 0.004217765</code></pre>
<p>可以发现<span class="math inline">\(\lambda\)</span>的估计值0.00925212和bootstrap估计值0.00925212是一样的，并且偏差为0.00151119非常小，标准差0.004217765也非常小</p>
</div>
<div id="ex-7.5" class="section level1">
<h1>EX 7.5</h1>
<p>Refer to Exercise 7.4. Compute 95% bootstrap confidence intervals for
the mean time between failures 1/λ by the standard normal, basic,
percentile, and BCa methods. Compare the intervals and explain why they
may differ.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># 加载必要的库</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># 确保结果可重复</span></span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">18</span>, <span class="dv">43</span>, <span class="dv">85</span>, <span class="dv">91</span>, <span class="dv">98</span>, <span class="dv">100</span>, <span class="dv">130</span>, <span class="dv">230</span>, <span class="dv">487</span>)</span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a><span class="co"># 定义一个函数，用于计算平均故障时间 1/λ</span></span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a>mean_time <span class="ot">&lt;-</span> <span class="cf">function</span>(data, index) {</span>
<span id="cb66-8"><a href="#cb66-8" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(data[index]))  <span class="co"># 返回 1/λ 即平均时间</span></span>
<span id="cb66-9"><a href="#cb66-9" tabindex="-1"></a>}</span>
<span id="cb66-10"><a href="#cb66-10" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" tabindex="-1"></a><span class="co"># 使用 bootstrapping 方法进行估计</span></span>
<span id="cb66-12"><a href="#cb66-12" tabindex="-1"></a>bootstrap_results <span class="ot">&lt;-</span> <span class="fu">boot</span>(data, mean_time, <span class="dv">10000</span>)</span>
<span id="cb66-13"><a href="#cb66-13" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" tabindex="-1"></a><span class="co"># 计算不同方法的95%置信区间</span></span>
<span id="cb66-15"><a href="#cb66-15" tabindex="-1"></a>ci_normal <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(bootstrap_results, <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>)</span>
<span id="cb66-16"><a href="#cb66-16" tabindex="-1"></a>ci_basic <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(bootstrap_results, <span class="at">type =</span> <span class="st">&quot;basic&quot;</span>)</span>
<span id="cb66-17"><a href="#cb66-17" tabindex="-1"></a>ci_percentile <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(bootstrap_results, <span class="at">type =</span> <span class="st">&quot;perc&quot;</span>)</span>
<span id="cb66-18"><a href="#cb66-18" tabindex="-1"></a>ci_bca <span class="ot">&lt;-</span> <span class="fu">boot.ci</span>(bootstrap_results, <span class="at">type =</span> <span class="st">&quot;bca&quot;</span>)</span>
<span id="cb66-19"><a href="#cb66-19" tabindex="-1"></a></span>
<span id="cb66-20"><a href="#cb66-20" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb66-21"><a href="#cb66-21" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Normal Method CI: &quot;</span>, ci_normal<span class="sc">$</span>normal[<span class="dv">2</span>], ci_normal<span class="sc">$</span>normal[<span class="dv">3</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Normal Method CI:  35.05313 182.4408</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Basic Method CI: &quot;</span>, ci_basic<span class="sc">$</span>basic[<span class="dv">4</span>], ci_basic<span class="sc">$</span>basic[<span class="dv">5</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Basic Method CI:  25.75417 170.0833</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Percentile Method CI: &quot;</span>, ci_percentile<span class="sc">$</span>percent[<span class="dv">4</span>], ci_percentile<span class="sc">$</span>percent[<span class="dv">5</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Percentile Method CI:  46.08333 190.4125</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;BCa Method CI: &quot;</span>, ci_bca<span class="sc">$</span>bca[<span class="dv">4</span>], ci_bca<span class="sc">$</span>bca[<span class="dv">5</span>], <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## BCa Method CI:  56.16667 221.4406</code></pre>
<p>标准正态方法：基于正态近似，假设 bootstrap
样本均值的分布是正态的。这在样本量大且分布接近正态时较为有效。</p>
<p>基本方法：基于原始数据的 bootstrap
样本直接构造置信区间，适用于非对称分布，但可能对样本大小敏感。</p>
<p>百分位数方法：直接使用 bootstrap
样本的分位数来构造置信区间，这种方法对极端值敏感。</p>
<p>BCa
方法：经过校正的置信区间，结合了偏差和加速因素，通常表现出更好的覆盖率和更少的偏差。</p>
</div>
<div id="第五次作业" class="section level1">
<h1>第五次作业</h1>
</div>
<div id="section-6" class="section level1">
<h1>7.8</h1>
<p>Refer to Exercise 7.7. Obtain the jackknife estimates of bias and
standard error of <span class="math inline">\(\hat\theta\)</span></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a><span class="fu">library</span>(bootstrap)</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="co"># 数据加载</span></span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> scor</span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a><span class="co"># 样本协方差占比如下</span></span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a>eigenvalues <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(data))<span class="sc">$</span>values</span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>theta_hat <span class="ot">&lt;-</span> eigenvalues[<span class="dv">1</span>] <span class="sc">/</span> <span class="fu">sum</span>(eigenvalues)</span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a><span class="co"># Jackknife部分</span></span>
<span id="cb75-9"><a href="#cb75-9" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb75-10"><a href="#cb75-10" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb75-11"><a href="#cb75-11" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb75-13"><a href="#cb75-13" tabindex="-1"></a>  eigvals_jack <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">cov</span>(data[<span class="sc">-</span>i, ]))<span class="sc">$</span>values  <span class="co"># 去掉第i个样本的协方差矩阵的特征值</span></span>
<span id="cb75-14"><a href="#cb75-14" tabindex="-1"></a>  theta[i] <span class="ot">&lt;-</span> eigvals_jack[<span class="dv">1</span>] <span class="sc">/</span> <span class="fu">sum</span>(eigvals_jack)</span>
<span id="cb75-15"><a href="#cb75-15" tabindex="-1"></a>}</span>
<span id="cb75-16"><a href="#cb75-16" tabindex="-1"></a></span>
<span id="cb75-17"><a href="#cb75-17" tabindex="-1"></a><span class="co"># Jackknife估计的偏差与标准差</span></span>
<span id="cb75-18"><a href="#cb75-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Jackknife估计的偏差与标准差分别为: &quot;</span>, (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="fu">mean</span>(theta) <span class="sc">-</span> theta_hat), <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="fu">sqrt</span>((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">mean</span>((theta <span class="sc">-</span> <span class="fu">mean</span>(theta))<span class="sc">^</span><span class="dv">2</span>)))</span></code></pre></div>
<pre><code>## Jackknife估计的偏差与标准差分别为:  0.001069139   0.04955231</code></pre>
</div>
<div id="ex-7.10" class="section level1">
<h1>EX 7.10</h1>
<p>In Example 7.18, leave-one-out (n-fold) cross validation was used to
select the best fitting model. Repeat the analysis replacing the Log-Log
model with a cubic polynomial model. Which of the four models is
selected by the cross validation procedure? Which model is selected
according to maximum adjusted <span class="math inline">\(R^2\)</span>?</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span></code></pre></div>
<pre><code>## Warning: package &#39;DAAG&#39; was built under R version 4.3.3</code></pre>
<p>将原Log-Log模型换成cubic polynomial model模型：</p>
<p><span class="math display">\[Y=\beta_0+\beta_1X+\beta_2X^2+\beta_3X^3+\epsilon\]</span></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="fu">attach</span>(ironslag)</span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(magnetic) <span class="co">#in DAAG ironslag</span></span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> e2 <span class="ot">&lt;-</span> e3 <span class="ot">&lt;-</span> e4 <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a><span class="co"># for n-fold cross validation</span></span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a><span class="co"># fit models on leave-one-out samples</span></span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>  y <span class="ot">&lt;-</span> magnetic[<span class="sc">-</span>k]</span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>  x <span class="ot">&lt;-</span> chemical[<span class="sc">-</span>k]</span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a>  </span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a>  J1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb79-11"><a href="#cb79-11" tabindex="-1"></a>  yhat1 <span class="ot">&lt;-</span> J1<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J1<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k]</span>
<span id="cb79-12"><a href="#cb79-12" tabindex="-1"></a>  e1[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat1</span>
<span id="cb79-13"><a href="#cb79-13" tabindex="-1"></a>  </span>
<span id="cb79-14"><a href="#cb79-14" tabindex="-1"></a>  J2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb79-15"><a href="#cb79-15" tabindex="-1"></a>  yhat2 <span class="ot">&lt;-</span> J2<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J2<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k] <span class="sc">+</span> J2<span class="sc">$</span>coef[<span class="dv">3</span>] <span class="sc">*</span> chemical[k]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb79-16"><a href="#cb79-16" tabindex="-1"></a>  e2[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat2</span>
<span id="cb79-17"><a href="#cb79-17" tabindex="-1"></a>  </span>
<span id="cb79-18"><a href="#cb79-18" tabindex="-1"></a>  J3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(y) <span class="sc">~</span> x)</span>
<span id="cb79-19"><a href="#cb79-19" tabindex="-1"></a>  logyhat3 <span class="ot">&lt;-</span> J3<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J3<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k]</span>
<span id="cb79-20"><a href="#cb79-20" tabindex="-1"></a>  yhat3 <span class="ot">&lt;-</span> <span class="fu">exp</span>(logyhat3)</span>
<span id="cb79-21"><a href="#cb79-21" tabindex="-1"></a>  e3[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat3</span>
<span id="cb79-22"><a href="#cb79-22" tabindex="-1"></a>  </span>
<span id="cb79-23"><a href="#cb79-23" tabindex="-1"></a>  J4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">3</span>))</span>
<span id="cb79-24"><a href="#cb79-24" tabindex="-1"></a>  yhat4 <span class="ot">&lt;-</span> J4<span class="sc">$</span>coef[<span class="dv">1</span>] <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">2</span>] <span class="sc">*</span> chemical[k] <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">3</span>] <span class="sc">*</span> chemical[k]<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> J4<span class="sc">$</span>coef[<span class="dv">4</span>] <span class="sc">*</span> chemical[k]<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb79-25"><a href="#cb79-25" tabindex="-1"></a>  e4[k] <span class="ot">&lt;-</span> magnetic[k] <span class="sc">-</span> yhat4</span>
<span id="cb79-26"><a href="#cb79-26" tabindex="-1"></a>}</span>
<span id="cb79-27"><a href="#cb79-27" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mean</span>(e1<span class="sc">^</span><span class="dv">2</span>), <span class="fu">mean</span>(e2<span class="sc">^</span><span class="dv">2</span>), <span class="fu">mean</span>(e3<span class="sc">^</span><span class="dv">2</span>), <span class="fu">mean</span>(e4<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 19.55644 17.85248 18.44188 18.17756</code></pre>
<p>根据cross validation
procedure，我们认为误差平方和最小的还是二号模型，值为17.85248</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>Y <span class="ot">&lt;-</span> magnetic</span>
<span id="cb81-2"><a href="#cb81-2" tabindex="-1"></a>X <span class="ot">&lt;-</span> chemical</span>
<span id="cb81-3"><a href="#cb81-3" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" tabindex="-1"></a><span class="co"># 比较调整后的 R^2</span></span>
<span id="cb81-5"><a href="#cb81-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">summary</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> X))<span class="sc">$</span>adj.r.squared, <span class="fu">summary</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> <span class="fu">I</span>(X<span class="sc">^</span><span class="dv">2</span>)))<span class="sc">$</span>adj.r.squared, <span class="fu">summary</span>(<span class="fu">lm</span>(<span class="fu">log</span>(Y) <span class="sc">~</span> X))<span class="sc">$</span>adj.r.squared, <span class="fu">summary</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> <span class="fu">I</span>(X<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(X<span class="sc">^</span><span class="dv">3</span>)))<span class="sc">$</span>adj.r.squared)</span></code></pre></div>
<pre><code>## 0.5281545 0.5768151 0.5280556 0.5740396</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">detach</span>(ironslag)</span></code></pre></div>
<p>以上是四种模型调整后的<span class="math inline">\(R^2\)</span>值，可以发现第二种模型调整后的<span class="math inline">\(R^2\)</span>值最大，为0.5768151，因此从两种角度来说都认为使用第二种模型拟合情况最好</p>
</div>
<div id="ex-8.1" class="section level1">
<h1>EX 8.1</h1>
<p>Implement the two-sample Cram´er-von Mises test for equal
distributions as a permutation test. Apply the test to the data in
Examples 8.1 and 8.2</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a><span class="co"># 课本上的数据</span></span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a><span class="fu">attach</span>(chickwts)</span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;soybean&quot;</span>]))</span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">as.vector</span>(weight[feed <span class="sc">==</span> <span class="st">&quot;linseed&quot;</span>]))</span>
<span id="cb84-5"><a href="#cb84-5" tabindex="-1"></a><span class="fu">detach</span>(chickwts)</span>
<span id="cb84-6"><a href="#cb84-6" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" tabindex="-1"></a><span class="co"># 定义 Cramér-von Mises 检验的统计量计算函数</span></span>
<span id="cb84-8"><a href="#cb84-8" tabindex="-1"></a>cvm_stat <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb84-9"><a href="#cb84-9" tabindex="-1"></a>  nx <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb84-10"><a href="#cb84-10" tabindex="-1"></a>  ny <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb84-11"><a href="#cb84-11" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb84-12"><a href="#cb84-12" tabindex="-1"></a>  Fx <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(x)(combined)</span>
<span id="cb84-13"><a href="#cb84-13" tabindex="-1"></a>  Fy <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(y)(combined)</span>
<span id="cb84-14"><a href="#cb84-14" tabindex="-1"></a>  Tn <span class="ot">&lt;-</span> (nx <span class="sc">*</span> ny <span class="sc">/</span> (nx <span class="sc">+</span> ny)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sum</span>((Fx <span class="sc">-</span> Fy)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb84-15"><a href="#cb84-15" tabindex="-1"></a>  <span class="fu">return</span>(Tn)</span>
<span id="cb84-16"><a href="#cb84-16" tabindex="-1"></a>}</span>
<span id="cb84-17"><a href="#cb84-17" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" tabindex="-1"></a><span class="co"># 原始样本的统计量</span></span>
<span id="cb84-19"><a href="#cb84-19" tabindex="-1"></a>T_obs <span class="ot">&lt;-</span> <span class="fu">cvm_stat</span>(x, y)</span>
<span id="cb84-20"><a href="#cb84-20" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" tabindex="-1"></a><span class="co"># 置换检验</span></span>
<span id="cb84-22"><a href="#cb84-22" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># 为了保证结果可重复</span></span>
<span id="cb84-23"><a href="#cb84-23" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># 置换次数</span></span>
<span id="cb84-24"><a href="#cb84-24" tabindex="-1"></a>T_perm <span class="ot">&lt;-</span> <span class="fu">numeric</span>(B)</span>
<span id="cb84-25"><a href="#cb84-25" tabindex="-1"></a></span>
<span id="cb84-26"><a href="#cb84-26" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B) {</span>
<span id="cb84-27"><a href="#cb84-27" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(x, y))</span>
<span id="cb84-28"><a href="#cb84-28" tabindex="-1"></a>  x_perm <span class="ot">&lt;-</span> combined[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)]</span>
<span id="cb84-29"><a href="#cb84-29" tabindex="-1"></a>  y_perm <span class="ot">&lt;-</span> combined[(<span class="fu">length</span>(x) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(combined)]</span>
<span id="cb84-30"><a href="#cb84-30" tabindex="-1"></a>  T_perm[i] <span class="ot">&lt;-</span> <span class="fu">cvm_stat</span>(x_perm, y_perm)</span>
<span id="cb84-31"><a href="#cb84-31" tabindex="-1"></a>}</span>
<span id="cb84-32"><a href="#cb84-32" tabindex="-1"></a></span>
<span id="cb84-33"><a href="#cb84-33" tabindex="-1"></a><span class="co"># 计算 p 值</span></span>
<span id="cb84-34"><a href="#cb84-34" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(T_obs, T_perm) <span class="sc">&gt;=</span> T_obs)</span>
<span id="cb84-35"><a href="#cb84-35" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Cramér-von Mises 置换检验的 p 值:&quot;</span>, p_value, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Cramér-von Mises 置换检验的 p 值: 0.4225774</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="fu">hist</span>(T_perm, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">breaks =</span> <span class="st">&quot;scott&quot;</span>)</span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a><span class="fu">points</span>(T_obs, <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">16</span>) <span class="co">#observed T</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>计算出来的p值为0.4225774，说明不拒绝原假设，认为喂食两种饲料的鸡的体重分布没有区别。柱状图标注了观测到的p值在所有拟合的p值中的位置，观察发现这个值并不极端。</p>
</div>
<div id="ex-8.2" class="section level1">
<h1>EX 8.2</h1>
<p>Implement the bivariate Spearman rank correlation test for
independence [255] as a permutation test. The Spearman rank correlation
test statistic can be obtained from function cor with method =
“spearman”. Compare the achieved significance level of the permutation
test with the p-value reported by cor.test on the same samples.</p>
<p>由于题目没有给出数据，我们自行生成两组正态分布随机数据</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="co"># 生成两个样本数据</span></span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">30</span>)</span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" tabindex="-1"></a><span class="co"># 计算原始样本的Spearman秩相关系数</span></span>
<span id="cb87-7"><a href="#cb87-7" tabindex="-1"></a>spearman_stat <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb87-8"><a href="#cb87-8" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" tabindex="-1"></a><span class="co"># 使用 cor.test 来获得 p 值</span></span>
<span id="cb87-10"><a href="#cb87-10" tabindex="-1"></a>cor_test_result <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x, y, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span>
<span id="cb87-11"><a href="#cb87-11" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" tabindex="-1"></a><span class="co"># 置换检验</span></span>
<span id="cb87-13"><a href="#cb87-13" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># 置换次数</span></span>
<span id="cb87-14"><a href="#cb87-14" tabindex="-1"></a>perm_stats <span class="ot">&lt;-</span> <span class="fu">numeric</span>(R)</span>
<span id="cb87-15"><a href="#cb87-15" tabindex="-1"></a></span>
<span id="cb87-16"><a href="#cb87-16" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>R) {</span>
<span id="cb87-17"><a href="#cb87-17" tabindex="-1"></a>  perm_stats[i] <span class="ot">&lt;-</span> <span class="fu">cor</span>(x, <span class="fu">sample</span>(y), <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="co"># 随机置换y并计算Spearman相关系数</span></span>
<span id="cb87-18"><a href="#cb87-18" tabindex="-1"></a>}</span>
<span id="cb87-19"><a href="#cb87-19" tabindex="-1"></a></span>
<span id="cb87-20"><a href="#cb87-20" tabindex="-1"></a><span class="co"># 计算置换检验的 p 值</span></span>
<span id="cb87-21"><a href="#cb87-21" tabindex="-1"></a>p_value_perm <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(<span class="fu">c</span>(perm_stats, spearman_stat)) <span class="sc">&gt;=</span> <span class="fu">abs</span>(spearman_stat))</span>
<span id="cb87-22"><a href="#cb87-22" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;cor.test 的 p 值:&quot;</span>, cor_test_result<span class="sc">$</span>p.value,<span class="st">&quot;置换检验的 p 值:&quot;</span>, p_value_perm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## cor.test 的 p 值: 0.5294988 置换检验的 p 值: 0.5274725</code></pre>
<p>置换检验的p值略小于cor.test的p值，说明置换检验相较于cor.test更倾向于拒绝原假设</p>
</div>
<div id="第六次作业" class="section level1">
<h1>第六次作业</h1>
</div>
<div id="ex-9.3" class="section level1">
<h1>EX 9.3</h1>
<p>Use the Metropolis-Hastings sampler to generate random variables from
a standard Cauchy distribution. Discard the first 1000 of the chain, and
compare the deciles of the generated observations with the deciles of
the standard Cauchy distribution (see qcauchy or qt with df=1). Recall
that a <span class="math inline">\(Cauchy(\theta,
\eta)\)</span>distribution has density function <span class="math display">\[
f(x) = \frac{1}{\theta\pi(1 + [(x-\eta)/\theta]^2)}, \quad -\infty &lt;
x &lt; \infty
\]</span></p>
<p>The standard Cauchy has the <span class="math inline">\(Cauchy(\theta=1, \eta=0)\)</span> density. (Note
that the standard Cauchy density is equal to the Student t density with
one degree of freedom.)</p>
<p>解答: 标准柯西分布的密度函数为： <span class="math display">\[f(x) =
\frac{1}{\pi(1 + x^2)}, \quad -\infty &lt; x &lt; \infty\]</span></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 总采样数</span></span>
<span id="cb89-3"><a href="#cb89-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)  <span class="co"># 初始化样本存储向量</span></span>
<span id="cb89-4"><a href="#cb89-4" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># 初始化</span></span>
<span id="cb89-5"><a href="#cb89-5" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb89-7"><a href="#cb89-7" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># 使用正态分布作为提议分布</span></span>
<span id="cb89-8"><a href="#cb89-8" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">dcauchy</span>(y) <span class="sc">/</span> <span class="fu">dcauchy</span>(x[i <span class="sc">-</span> <span class="dv">1</span>])) {</span>
<span id="cb89-9"><a href="#cb89-9" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb89-10"><a href="#cb89-10" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb89-11"><a href="#cb89-11" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] </span>
<span id="cb89-12"><a href="#cb89-12" tabindex="-1"></a>  }</span>
<span id="cb89-13"><a href="#cb89-13" tabindex="-1"></a>}</span>
<span id="cb89-14"><a href="#cb89-14" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" tabindex="-1"></a>samples <span class="ot">&lt;-</span> x[(<span class="dv">1000</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n] <span class="co"># 去掉前1000个值</span></span>
<span id="cb89-16"><a href="#cb89-16" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" tabindex="-1"></a><span class="co"># 比较样本和理论柯西分布的分位数</span></span>
<span id="cb89-18"><a href="#cb89-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;分位数为：&quot;</span>,<span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>,<span class="fl">0.1</span>),<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 分位数为： 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;样本分位数：&quot;</span>,<span class="fu">quantile</span>(samples, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)),<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 样本分位数： -2.817489 -1.402669 -0.7378453 -0.3335088 -0.01642563 0.3070602 0.7233017 1.372667 3.028368</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;理论分位数：&quot;</span>,<span class="fu">qcauchy</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)))</span></code></pre></div>
<pre><code>## 理论分位数： -3.077684 -1.376382 -0.7265425 -0.3249197 0 0.3249197 0.7265425 1.376382 3.077684</code></pre>
</div>
<div id="ex-9.8" class="section level1">
<h1>EX 9.8</h1>
<p>This example appears in [40]. Consider the bivariate density</p>
<p><span class="math display">\[
f(x, y) \propto \binom{n}{x} y^{x + a - 1} (1 - y)^{n - x + b - 1},
\quad x = 0, 1, \dots, n, \quad 0 \le y \le 1.
\]</span></p>
<p>It can be shown (see e.g. [23]) that for fixed <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(n\)</span>, the conditional distributions are
Binomial(<span class="math inline">\(n\)</span>, <span class="math inline">\(y\)</span>) and Beta(<span class="math inline">\(x
+ a\)</span>, <span class="math inline">\(n - x + b\)</span>). Use the
Gibbs sampler to generate a chain with target joint density <span class="math inline">\(f(x, y)\)</span>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)      </span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span>            <span class="co"># 总样本数</span></span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span>             </span>
<span id="cb95-4"><a href="#cb95-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span>             <span class="co"># Beta分布的参数a和b</span></span>
<span id="cb95-5"><a href="#cb95-5" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" tabindex="-1"></a><span class="co"># 初始化链</span></span>
<span id="cb95-7"><a href="#cb95-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)  <span class="co"># 迭代1000次</span></span>
<span id="cb95-8"><a href="#cb95-8" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)</span>
<span id="cb95-9"><a href="#cb95-9" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, <span class="fl">0.5</span>)  <span class="co"># 初始化x的值</span></span>
<span id="cb95-10"><a href="#cb95-10" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x[<span class="dv">1</span>] <span class="sc">+</span> a, n <span class="sc">-</span> x[<span class="dv">1</span>] <span class="sc">+</span> b)  <span class="co"># 初始化y的值</span></span>
<span id="cb95-11"><a href="#cb95-11" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" tabindex="-1"></a><span class="co"># Gibbs采样</span></span>
<span id="cb95-13"><a href="#cb95-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb95-14"><a href="#cb95-14" tabindex="-1"></a>  <span class="co"># 更新条件分布</span></span>
<span id="cb95-15"><a href="#cb95-15" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">prob =</span> y[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb95-16"><a href="#cb95-16" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> x[i] <span class="sc">+</span> a, <span class="at">shape2 =</span> n <span class="sc">-</span> x[i] <span class="sc">+</span> b)</span>
<span id="cb95-17"><a href="#cb95-17" tabindex="-1"></a>}</span>
<span id="cb95-18"><a href="#cb95-18" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]</span>
<span id="cb95-21"><a href="#cb95-21" tabindex="-1"></a>y <span class="ot">&lt;-</span> y[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]  <span class="co"># 去掉前100个数避免初始值影响</span></span>
<span id="cb95-22"><a href="#cb95-22" tabindex="-1"></a></span>
<span id="cb95-23"><a href="#cb95-23" tabindex="-1"></a><span class="co"># 可视化生成样本的分布情况</span></span>
<span id="cb95-24"><a href="#cb95-24" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">main =</span> <span class="st">&quot;Gibbs&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="补充问题-1" class="section level1">
<h1>补充问题</h1>
<p>For each of the above exercise, use the Gelman-Rubin method to
monitor convergence of the chain, and run the chain until it converges
approximately to the target distribution according to <span class="math inline">\(\hat R\)</span> &lt; 1.2</p>
<p>一般Gelman-Rubin
method需要重复实验3~5次，我们重复三次，计算三条链的总体方差和每条链的内部方差，比值和1.2比大小.</p>
<p>首先是EX 9.3：</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb96-2"><a href="#cb96-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># 总采样数</span></span>
<span id="cb96-3"><a href="#cb96-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)  <span class="co"># 初始化样本存储向量</span></span>
<span id="cb96-4"><a href="#cb96-4" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># 初始化</span></span>
<span id="cb96-5"><a href="#cb96-5" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb96-7"><a href="#cb96-7" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># 使用正态分布作为提议分布</span></span>
<span id="cb96-8"><a href="#cb96-8" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">dcauchy</span>(y) <span class="sc">/</span> <span class="fu">dcauchy</span>(x[i <span class="sc">-</span> <span class="dv">1</span>])) {</span>
<span id="cb96-9"><a href="#cb96-9" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb96-10"><a href="#cb96-10" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb96-11"><a href="#cb96-11" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] </span>
<span id="cb96-12"><a href="#cb96-12" tabindex="-1"></a>  }</span>
<span id="cb96-13"><a href="#cb96-13" tabindex="-1"></a>}</span>
<span id="cb96-14"><a href="#cb96-14" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> x[(<span class="dv">1000</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n] <span class="co"># 第一组</span></span>
<span id="cb96-15"><a href="#cb96-15" tabindex="-1"></a></span>
<span id="cb96-16"><a href="#cb96-16" tabindex="-1"></a></span>
<span id="cb96-17"><a href="#cb96-17" tabindex="-1"></a></span>
<span id="cb96-18"><a href="#cb96-18" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)  <span class="co"># 初始化样本存储向量</span></span>
<span id="cb96-19"><a href="#cb96-19" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># 初始化</span></span>
<span id="cb96-20"><a href="#cb96-20" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb96-22"><a href="#cb96-22" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># 使用正态分布作为提议分布</span></span>
<span id="cb96-23"><a href="#cb96-23" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">dcauchy</span>(y) <span class="sc">/</span> <span class="fu">dcauchy</span>(x[i <span class="sc">-</span> <span class="dv">1</span>])) {</span>
<span id="cb96-24"><a href="#cb96-24" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb96-25"><a href="#cb96-25" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb96-26"><a href="#cb96-26" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] </span>
<span id="cb96-27"><a href="#cb96-27" tabindex="-1"></a>  }</span>
<span id="cb96-28"><a href="#cb96-28" tabindex="-1"></a>}</span>
<span id="cb96-29"><a href="#cb96-29" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> x[(<span class="dv">1000</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n] <span class="co"># 第二组</span></span>
<span id="cb96-30"><a href="#cb96-30" tabindex="-1"></a></span>
<span id="cb96-31"><a href="#cb96-31" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" tabindex="-1"></a></span>
<span id="cb96-33"><a href="#cb96-33" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)  <span class="co"># 初始化样本存储向量</span></span>
<span id="cb96-34"><a href="#cb96-34" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># 初始化</span></span>
<span id="cb96-35"><a href="#cb96-35" tabindex="-1"></a></span>
<span id="cb96-36"><a href="#cb96-36" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb96-37"><a href="#cb96-37" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)  <span class="co"># 使用正态分布作为提议分布</span></span>
<span id="cb96-38"><a href="#cb96-38" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">dcauchy</span>(y) <span class="sc">/</span> <span class="fu">dcauchy</span>(x[i <span class="sc">-</span> <span class="dv">1</span>])) {</span>
<span id="cb96-39"><a href="#cb96-39" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> y</span>
<span id="cb96-40"><a href="#cb96-40" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb96-41"><a href="#cb96-41" tabindex="-1"></a>    x[i] <span class="ot">&lt;-</span> x[i <span class="sc">-</span> <span class="dv">1</span>] </span>
<span id="cb96-42"><a href="#cb96-42" tabindex="-1"></a>  }</span>
<span id="cb96-43"><a href="#cb96-43" tabindex="-1"></a>}</span>
<span id="cb96-44"><a href="#cb96-44" tabindex="-1"></a>c3 <span class="ot">&lt;-</span> x[(<span class="dv">1000</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>n] <span class="co"># 第三组</span></span>
<span id="cb96-45"><a href="#cb96-45" tabindex="-1"></a></span>
<span id="cb96-46"><a href="#cb96-46" tabindex="-1"></a>B <span class="ot">&lt;-</span> (n<span class="dv">-1000</span>)<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span><span class="fu">var</span>(<span class="fu">c</span>(<span class="fu">mean</span>(c1), <span class="fu">mean</span>(c2), <span class="fu">mean</span>(c3)))</span>
<span id="cb96-47"><a href="#cb96-47" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span><span class="fu">sum</span>(<span class="fu">var</span>(c1), <span class="fu">var</span>(c2), <span class="fu">var</span>(c3))</span>
<span id="cb96-48"><a href="#cb96-48" tabindex="-1"></a>R_hat <span class="ot">&lt;-</span> (<span class="dv">8999</span><span class="sc">/</span><span class="dv">9000</span><span class="sc">*</span>W<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="dv">9000</span><span class="sc">*</span>B)<span class="sc">/</span>W</span>
<span id="cb96-49"><a href="#cb96-49" tabindex="-1"></a>R_hat</span></code></pre></div>
<pre><code>## [1] 1.014332</code></pre>
<p>说明此时<span class="math inline">\(\hat
R=1.014\)</span>确实小于1.2，认为链收敛。</p>
<p>再考虑EX 9.8</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)      </span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span>            <span class="co"># 总样本数</span></span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">1</span>             </span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span>             <span class="co"># Beta分布的参数a和b</span></span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" tabindex="-1"></a><span class="co"># 初始化链</span></span>
<span id="cb98-7"><a href="#cb98-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)  <span class="co"># 迭代1000次</span></span>
<span id="cb98-8"><a href="#cb98-8" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)</span>
<span id="cb98-9"><a href="#cb98-9" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, <span class="fl">0.5</span>)  <span class="co"># 初始化x的值</span></span>
<span id="cb98-10"><a href="#cb98-10" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x[<span class="dv">1</span>] <span class="sc">+</span> a, n <span class="sc">-</span> x[<span class="dv">1</span>] <span class="sc">+</span> b)  <span class="co"># 初始化y的值</span></span>
<span id="cb98-11"><a href="#cb98-11" tabindex="-1"></a></span>
<span id="cb98-12"><a href="#cb98-12" tabindex="-1"></a><span class="co"># Gibbs采样</span></span>
<span id="cb98-13"><a href="#cb98-13" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb98-14"><a href="#cb98-14" tabindex="-1"></a>  <span class="co"># 更新条件分布</span></span>
<span id="cb98-15"><a href="#cb98-15" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">prob =</span> y[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb98-16"><a href="#cb98-16" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> x[i] <span class="sc">+</span> a, <span class="at">shape2 =</span> n <span class="sc">-</span> x[i] <span class="sc">+</span> b)</span>
<span id="cb98-17"><a href="#cb98-17" tabindex="-1"></a>}</span>
<span id="cb98-18"><a href="#cb98-18" tabindex="-1"></a></span>
<span id="cb98-19"><a href="#cb98-19" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]</span>
<span id="cb98-20"><a href="#cb98-20" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> y[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]  <span class="co"># 去掉前100个数避免初始值影响</span></span>
<span id="cb98-21"><a href="#cb98-21" tabindex="-1"></a></span>
<span id="cb98-22"><a href="#cb98-22" tabindex="-1"></a></span>
<span id="cb98-23"><a href="#cb98-23" tabindex="-1"></a></span>
<span id="cb98-24"><a href="#cb98-24" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)  <span class="co"># 迭代1000次</span></span>
<span id="cb98-25"><a href="#cb98-25" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)</span>
<span id="cb98-26"><a href="#cb98-26" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, <span class="fl">0.5</span>)  <span class="co"># 初始化x的值</span></span>
<span id="cb98-27"><a href="#cb98-27" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x[<span class="dv">1</span>] <span class="sc">+</span> a, n <span class="sc">-</span> x[<span class="dv">1</span>] <span class="sc">+</span> b)  <span class="co"># 初始化y的值</span></span>
<span id="cb98-28"><a href="#cb98-28" tabindex="-1"></a></span>
<span id="cb98-29"><a href="#cb98-29" tabindex="-1"></a><span class="co"># Gibbs采样</span></span>
<span id="cb98-30"><a href="#cb98-30" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb98-31"><a href="#cb98-31" tabindex="-1"></a>  <span class="co"># 更新条件分布</span></span>
<span id="cb98-32"><a href="#cb98-32" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">prob =</span> y[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb98-33"><a href="#cb98-33" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> x[i] <span class="sc">+</span> a, <span class="at">shape2 =</span> n <span class="sc">-</span> x[i] <span class="sc">+</span> b)</span>
<span id="cb98-34"><a href="#cb98-34" tabindex="-1"></a>}</span>
<span id="cb98-35"><a href="#cb98-35" tabindex="-1"></a></span>
<span id="cb98-36"><a href="#cb98-36" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> x[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]</span>
<span id="cb98-37"><a href="#cb98-37" tabindex="-1"></a>y2 <span class="ot">&lt;-</span> y[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]  <span class="co"># 去掉前100个数避免初始值影响</span></span>
<span id="cb98-38"><a href="#cb98-38" tabindex="-1"></a></span>
<span id="cb98-39"><a href="#cb98-39" tabindex="-1"></a></span>
<span id="cb98-40"><a href="#cb98-40" tabindex="-1"></a></span>
<span id="cb98-41"><a href="#cb98-41" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)  <span class="co"># 迭代1000次</span></span>
<span id="cb98-42"><a href="#cb98-42" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">1000</span>)</span>
<span id="cb98-43"><a href="#cb98-43" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n, <span class="fl">0.5</span>)  <span class="co"># 初始化x的值</span></span>
<span id="cb98-44"><a href="#cb98-44" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, x[<span class="dv">1</span>] <span class="sc">+</span> a, n <span class="sc">-</span> x[<span class="dv">1</span>] <span class="sc">+</span> b)  <span class="co"># 初始化y的值</span></span>
<span id="cb98-45"><a href="#cb98-45" tabindex="-1"></a></span>
<span id="cb98-46"><a href="#cb98-46" tabindex="-1"></a><span class="co"># Gibbs采样</span></span>
<span id="cb98-47"><a href="#cb98-47" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb98-48"><a href="#cb98-48" tabindex="-1"></a>  <span class="co"># 更新条件分布</span></span>
<span id="cb98-49"><a href="#cb98-49" tabindex="-1"></a>  x[i] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">prob =</span> y[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb98-50"><a href="#cb98-50" tabindex="-1"></a>  y[i] <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="at">shape1 =</span> x[i] <span class="sc">+</span> a, <span class="at">shape2 =</span> n <span class="sc">-</span> x[i] <span class="sc">+</span> b)</span>
<span id="cb98-51"><a href="#cb98-51" tabindex="-1"></a>}</span>
<span id="cb98-52"><a href="#cb98-52" tabindex="-1"></a></span>
<span id="cb98-53"><a href="#cb98-53" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> x[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]</span>
<span id="cb98-54"><a href="#cb98-54" tabindex="-1"></a>y3 <span class="ot">&lt;-</span> y[(<span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1000</span>]  <span class="co"># 去掉前100个数避免初始值影响</span></span>
<span id="cb98-55"><a href="#cb98-55" tabindex="-1"></a></span>
<span id="cb98-56"><a href="#cb98-56" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">900</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">var</span>(<span class="fu">c</span>(<span class="fu">mean</span>(x1), <span class="fu">mean</span>(x2), <span class="fu">mean</span>(x3))) <span class="sc">+</span> <span class="fu">var</span>(<span class="fu">c</span>(<span class="fu">mean</span>(y1), <span class="fu">mean</span>(y2), <span class="fu">mean</span>(y3))))</span>
<span id="cb98-57"><a href="#cb98-57" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(<span class="fu">sum</span>(<span class="fu">var</span>(x1), <span class="fu">var</span>(x2), <span class="fu">var</span>(x3)) <span class="sc">+</span> <span class="fu">sum</span>(<span class="fu">var</span>(y1), <span class="fu">var</span>(y2), <span class="fu">var</span>(y3)))</span>
<span id="cb98-58"><a href="#cb98-58" tabindex="-1"></a>R_hat <span class="ot">&lt;-</span> (<span class="dv">899</span><span class="sc">/</span><span class="dv">900</span><span class="sc">*</span>W<span class="sc">+</span><span class="dv">1</span><span class="sc">/</span><span class="dv">900</span><span class="sc">*</span>B)<span class="sc">/</span>W</span>
<span id="cb98-59"><a href="#cb98-59" tabindex="-1"></a>R_hat</span></code></pre></div>
<pre><code>## [1] 1.007375</code></pre>
<p>显然此时<span class="math inline">\(\hat
R=1.007\)</span>也小于1.2，认为此时链也收敛。</p>
</div>
<div id="证明平稳条件" class="section level1">
<h1>证明平稳条件</h1>
<p>对于状态 <span class="math inline">\(s\)</span> 和 <span class="math inline">\(r\)</span>，不妨假设<span class="math inline">\(s
\neq r\)</span> ，否则显然平稳条件成立。我们有：</p>
<p><span class="math display">\[
K(s,r) f(s) = g(r \mid s) \alpha(s,r) f(s).
\]</span></p>
<p>根据 <span class="math inline">\(\alpha(s,r)\)</span>
的定义，我们可以将其展开为：</p>
<p><span class="math display">\[
K(s,r) f(s) = g(r \mid s) \min \left\{ \frac{f(r) g(s \mid r)}{f(s) g(r
\mid s)}, 1 \right\} f(s).
\]</span></p>
<p>如果</p>
<p><span class="math display">\[
\frac{f(s) g(r \mid s)}{f(r) g(s \mid r)} \leq 1,
\]</span></p>
<p>则</p>
<p><span class="math display">\[
\alpha(s,r) = \frac{f(r) g(s \mid r)}{f(s) g(r \mid s)},
\]</span></p>
<p>因此</p>
<p><span class="math display">\[
K(s,r) f(s) = g(r \mid s) \frac{f(r) g(s \mid r)}{f(s) g(r \mid s)} f(s)
= f(r) g(s \mid r) = K(r,s) f(r).
\]</span></p>
<p>如果</p>
<p><span class="math display">\[
\frac{f(s) g(r \mid s)}{f(r) g(s \mid r)} &gt; 1,
\]</span></p>
<p>则</p>
<p><span class="math display">\[
\alpha(s,r) = 1,
\]</span></p>
<p>因此</p>
<p><span class="math display">\[
K(s,r) f(s) = g(r \mid s) f(s) = f(r) g(s \mid r) = K(r,s) f(r).
\]</span></p>
<div id="结论" class="section level2">
<h2>结论</h2>
<p>通过验证细致平衡条件</p>
<p><span class="math display">\[
K(s,r) f(s) = K(r,s) f(r),
\]</span></p>
<p>我们证明了 Metropolis-Hastings 算法在连续情况下的平稳性。</p>
</div>
</div>
<div id="第七次作业" class="section level1">
<h1>第七次作业</h1>
</div>
<div id="ex-11.3" class="section level1">
<h1>EX 11.3</h1>
<ol style="list-style-type: lower-alpha">
<li>Write a function to compute the <span class="math inline">\(k\)</span>th term in <span class="math display">\[
\sum_{k=0}^{\infty} \frac{(-1)^k}{k! 2^k} \frac{\|a\|^{2k+2}}{(2k +
1)(2k + 2)} \frac{\Gamma \left( \frac{d+1}{2} \right)\Gamma \left( k +
\frac{3}{2} \right)}{ \Gamma \left( k +\frac{ d}{2} + 1 \right)},
\]</span> where <span class="math inline">\(d \geq 1\)</span> is an
integer, <span class="math inline">\(a\)</span> is a vector in <span class="math inline">\(\mathbb{R}^d\)</span>, and <span class="math inline">\(\|\cdot\|\)</span> denotes the Euclidean norm.
Perform the arithmetic so that the coefficients can be computed for
(almost) arbitrarily large <span class="math inline">\(k\)</span> and
<span class="math inline">\(d\)</span>. (This sum converges for all
<span class="math inline">\(a \in \mathbb{R}^d\)</span>).</li>
</ol>
<p>使用lgamma函数避免gamma函数过大</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="fu">library</span>(gsl) </span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a><span class="co"># 计算第 k 项函数</span></span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a>kth_term <span class="ot">&lt;-</span> <span class="cf">function</span>(k, d, a) {</span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a>  term <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span>k <span class="sc">/</span> (<span class="fu">factorial</span>(k) <span class="sc">*</span> <span class="dv">2</span><span class="sc">^</span>k) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(a<span class="sc">^</span><span class="dv">2</span>))<span class="sc">^</span>(<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">2</span>) <span class="sc">/</span> ((<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">exp</span>(<span class="fu">lgamma</span>((d <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">lgamma</span>(k <span class="sc">+</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">-</span> <span class="fu">lgamma</span>(k <span class="sc">+</span> d <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb100-5"><a href="#cb100-5" tabindex="-1"></a>  <span class="fu">return</span>(term)</span>
<span id="cb100-6"><a href="#cb100-6" tabindex="-1"></a>}</span>
<span id="cb100-7"><a href="#cb100-7" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" tabindex="-1"></a><span class="co"># 对较大的k和d测试</span></span>
<span id="cb100-9"><a href="#cb100-9" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb100-10"><a href="#cb100-10" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>) </span>
<span id="cb100-11"><a href="#cb100-11" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb100-12"><a href="#cb100-12" tabindex="-1"></a><span class="fu">kth_term</span>(k, d, a)</span></code></pre></div>
<pre><code>## [1] 1.400702e-204</code></pre>
<p>发现可以计算出正确的结果</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Modify the function so that it computes and returns the sum.</li>
</ol>
<p>当加项小于1e-10的时候停止求和</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a>sum_series <span class="ot">&lt;-</span> <span class="cf">function</span>(d, a, <span class="at">tol =</span> <span class="fl">1e-10</span>) {</span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a>  sum <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a>  <span class="cf">repeat</span> {</span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a>    term <span class="ot">&lt;-</span> <span class="fu">kth_term</span>(k, d, a)</span>
<span id="cb102-6"><a href="#cb102-6" tabindex="-1"></a>    sum <span class="ot">&lt;-</span> sum <span class="sc">+</span> term</span>
<span id="cb102-7"><a href="#cb102-7" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(term) <span class="sc">&lt;</span> tol) <span class="cf">break</span> </span>
<span id="cb102-8"><a href="#cb102-8" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb102-9"><a href="#cb102-9" tabindex="-1"></a>  }</span>
<span id="cb102-10"><a href="#cb102-10" tabindex="-1"></a>  <span class="fu">return</span>(sum)</span>
<span id="cb102-11"><a href="#cb102-11" tabindex="-1"></a>}</span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Evaluate the sum when a = (1, 2)T .</li>
</ol>
<p>取d = 100求和</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">sum_series</span>(d, a)</span>
<span id="cb103-4"><a href="#cb103-4" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] 0.3088054</code></pre>
</div>
<div id="ex-11.5" class="section level1">
<h1>EX 11.5</h1>
<p>Write a function to solve the equation</p>
<p><span class="math display">\[
\frac{2 \Gamma \left( \frac{k}{2} \right)}{\sqrt{\pi (k - 1)} \Gamma
\left( \frac{k - 1}{2} \right)} \int_0^{c_{k-1}} \left( 1 + \frac{u^2}{k
- 1} \right)^{-\frac{k}{2}} du = \frac{2 \Gamma \left( \frac{k+1}{2}
\right)}{\sqrt{\pi k} \Gamma \left( \frac{k}{2} \right)} \int_0^{c_k}
\left( 1 + \frac{u^2}{k} \right)^{-\frac{k+1}{2}} du
\]</span></p>
<p>for <span class="math inline">\(a\)</span>, where</p>
<p><span class="math display">\[
c_k = \sqrt{\frac{a^2 k}{k + 1 - a^2}}.
\]</span></p>
<p>Compare the solutions with the points <span class="math inline">\(A(k)\)</span> in Exercise 11.4.</p>
<p>我们在k = 5时计算a的值：</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="co"># 定义左侧的积分函数</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a>left_integral <span class="ot">&lt;-</span> <span class="cf">function</span>(k, c_k_minus_1) {</span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a>  integrand <span class="ot">&lt;-</span> <span class="cf">function</span>(u) {</span>
<span id="cb105-4"><a href="#cb105-4" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> u<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> (k <span class="sc">-</span> <span class="dv">1</span>))<span class="sc">^</span>(<span class="sc">-</span>k <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb105-5"><a href="#cb105-5" tabindex="-1"></a>  }</span>
<span id="cb105-6"><a href="#cb105-6" tabindex="-1"></a>  <span class="fu">integrate</span>(integrand, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> c_k_minus_1)<span class="sc">$</span>value</span>
<span id="cb105-7"><a href="#cb105-7" tabindex="-1"></a>}</span>
<span id="cb105-8"><a href="#cb105-8" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" tabindex="-1"></a><span class="co"># 定义右侧的积分函数</span></span>
<span id="cb105-10"><a href="#cb105-10" tabindex="-1"></a>right_integral <span class="ot">&lt;-</span> <span class="cf">function</span>(k, c_k) {</span>
<span id="cb105-11"><a href="#cb105-11" tabindex="-1"></a>  integrand <span class="ot">&lt;-</span> <span class="cf">function</span>(u) {</span>
<span id="cb105-12"><a href="#cb105-12" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> u<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> k)<span class="sc">^</span>(<span class="sc">-</span>(k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb105-13"><a href="#cb105-13" tabindex="-1"></a>  }</span>
<span id="cb105-14"><a href="#cb105-14" tabindex="-1"></a>  <span class="fu">integrate</span>(integrand, <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> c_k)<span class="sc">$</span>value</span>
<span id="cb105-15"><a href="#cb105-15" tabindex="-1"></a>}</span>
<span id="cb105-16"><a href="#cb105-16" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" tabindex="-1"></a><span class="co"># 定义 c_k 公式</span></span>
<span id="cb105-18"><a href="#cb105-18" tabindex="-1"></a>c_k <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k) {</span>
<span id="cb105-19"><a href="#cb105-19" tabindex="-1"></a>  <span class="fu">sqrt</span>((a<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> k) <span class="sc">/</span> (k <span class="sc">+</span> <span class="dv">1</span> <span class="sc">-</span> a<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb105-20"><a href="#cb105-20" tabindex="-1"></a>}</span>
<span id="cb105-21"><a href="#cb105-21" tabindex="-1"></a></span>
<span id="cb105-22"><a href="#cb105-22" tabindex="-1"></a>target_function <span class="ot">&lt;-</span> <span class="cf">function</span>(a, k) {</span>
<span id="cb105-23"><a href="#cb105-23" tabindex="-1"></a>  </span>
<span id="cb105-24"><a href="#cb105-24" tabindex="-1"></a>  c_k_minus_1 <span class="ot">&lt;-</span> <span class="fu">c_k</span>(a, k <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb105-25"><a href="#cb105-25" tabindex="-1"></a>  c_k_value <span class="ot">&lt;-</span> <span class="fu">c_k</span>(a, k)</span>
<span id="cb105-26"><a href="#cb105-26" tabindex="-1"></a>  </span>
<span id="cb105-27"><a href="#cb105-27" tabindex="-1"></a>  <span class="co"># 计算左右两边的值</span></span>
<span id="cb105-28"><a href="#cb105-28" tabindex="-1"></a>  left_value <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">gamma</span>(k <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(pi <span class="sc">*</span> (k <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">*</span> <span class="fu">gamma</span>((k <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">left_integral</span>(k, c_k_minus_1)</span>
<span id="cb105-29"><a href="#cb105-29" tabindex="-1"></a>  right_value <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">gamma</span>((k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(pi <span class="sc">*</span> k) <span class="sc">*</span> <span class="fu">gamma</span>(k <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">right_integral</span>(k, c_k_value)</span>
<span id="cb105-30"><a href="#cb105-30" tabindex="-1"></a>  </span>
<span id="cb105-31"><a href="#cb105-31" tabindex="-1"></a>  <span class="co"># 返回左右差值</span></span>
<span id="cb105-32"><a href="#cb105-32" tabindex="-1"></a>  left_value <span class="sc">-</span> right_value</span>
<span id="cb105-33"><a href="#cb105-33" tabindex="-1"></a>}</span>
<span id="cb105-34"><a href="#cb105-34" tabindex="-1"></a></span>
<span id="cb105-35"><a href="#cb105-35" tabindex="-1"></a><span class="co"># 这里区间取成0,1到sqrt(k)-0.05是为了保护分母</span></span>
<span id="cb105-36"><a href="#cb105-36" tabindex="-1"></a>solve_a <span class="ot">&lt;-</span> <span class="cf">function</span>(k, <span class="at">interval =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fu">sqrt</span>(k)<span class="sc">-</span><span class="fl">0.05</span>)) {</span>
<span id="cb105-37"><a href="#cb105-37" tabindex="-1"></a>  <span class="fu">uniroot</span>(<span class="cf">function</span>(a) <span class="fu">target_function</span>(a, k), <span class="at">interval =</span> interval)<span class="sc">$</span>root</span>
<span id="cb105-38"><a href="#cb105-38" tabindex="-1"></a>}</span>
<span id="cb105-39"><a href="#cb105-39" tabindex="-1"></a></span>
<span id="cb105-40"><a href="#cb105-40" tabindex="-1"></a><span class="co"># 在k=5时计算a的值</span></span>
<span id="cb105-41"><a href="#cb105-41" tabindex="-1"></a>k_value <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb105-42"><a href="#cb105-42" tabindex="-1"></a>a_solution <span class="ot">&lt;-</span> <span class="fu">solve_a</span>(k_value)</span>
<span id="cb105-43"><a href="#cb105-43" tabindex="-1"></a>a_solution</span></code></pre></div>
<pre><code>## [1] 1.533564</code></pre>
<p>显然a还可以取负值，因此-1.533582也是a的一个解</p>
</div>
<div id="补充问题-2" class="section level1">
<h1>补充问题</h1>
<p>Suppose <span class="math inline">\(T_1, \ldots, T_n\)</span> are
i.i.d. samples drawn from the exponential distribution with expectation
<span class="math inline">\(\lambda\)</span>. Those values greater than
<span class="math inline">\(\tau\)</span> are not observed due to right
censorship, so that the observed values are <span class="math inline">\(Y_i = T_i I(T_i \leq \tau) + \tau I(T_i &gt;
\tau)\)</span>, <span class="math inline">\(i = 1, \ldots, n\)</span>.
Suppose <span class="math inline">\(\tau = 1\)</span> and the observed
<span class="math inline">\(Y_i\)</span> values are as follows: 0.54,
0.48, 0.33, 0.43, 1.00, 1.00, 0.91, 1.00, 0.21, 0.85 Use the E-M
algorithm to estimate <span class="math inline">\(\lambda\)</span>,
compare your result with the observed data MLE (note: <span class="math inline">\(Y_i\)</span> follows a mixture distribution)</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a><span class="co"># 初始化数据</span></span>
<span id="cb107-2"><a href="#cb107-2" tabindex="-1"></a>observed_Y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.54</span>, <span class="fl">0.48</span>, <span class="fl">0.33</span>, <span class="fl">0.43</span>, <span class="fl">1.00</span>, <span class="fl">1.00</span>, <span class="fl">0.91</span>, <span class="fl">1.00</span>, <span class="fl">0.21</span>, <span class="fl">0.85</span>)</span>
<span id="cb107-3"><a href="#cb107-3" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb107-4"><a href="#cb107-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(observed_Y)</span>
<span id="cb107-5"><a href="#cb107-5" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" tabindex="-1"></a><span class="co"># 初始猜测的 lambda 值</span></span>
<span id="cb107-7"><a href="#cb107-7" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb107-8"><a href="#cb107-8" tabindex="-1"></a>tol <span class="ot">&lt;-</span> <span class="fl">1e-6</span></span>
<span id="cb107-9"><a href="#cb107-9" tabindex="-1"></a>max_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb107-10"><a href="#cb107-10" tabindex="-1"></a>log_likelihood_diff <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb107-11"><a href="#cb107-11" tabindex="-1"></a>iteration <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb107-12"><a href="#cb107-12" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" tabindex="-1"></a><span class="cf">while</span> (log_likelihood_diff <span class="sc">&gt;</span> tol <span class="sc">&amp;&amp;</span> iteration <span class="sc">&lt;</span> max_iter) {</span>
<span id="cb107-14"><a href="#cb107-14" tabindex="-1"></a>  iteration <span class="ot">&lt;-</span> iteration <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb107-15"><a href="#cb107-15" tabindex="-1"></a>  </span>
<span id="cb107-16"><a href="#cb107-16" tabindex="-1"></a>  <span class="co"># E-step: 计算被截尾的 Y_i = 1 的缺失部分</span></span>
<span id="cb107-17"><a href="#cb107-17" tabindex="-1"></a>  expected_T <span class="ot">&lt;-</span> observed_Y</span>
<span id="cb107-18"><a href="#cb107-18" tabindex="-1"></a>  censored_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(observed_Y <span class="sc">==</span> tau)</span>
<span id="cb107-19"><a href="#cb107-19" tabindex="-1"></a>  </span>
<span id="cb107-20"><a href="#cb107-20" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(censored_indices) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb107-21"><a href="#cb107-21" tabindex="-1"></a>    expected_T[censored_indices] <span class="ot">&lt;-</span> tau <span class="sc">+</span> lambda</span>
<span id="cb107-22"><a href="#cb107-22" tabindex="-1"></a>  }</span>
<span id="cb107-23"><a href="#cb107-23" tabindex="-1"></a>  </span>
<span id="cb107-24"><a href="#cb107-24" tabindex="-1"></a>  <span class="co"># M-step: 更新 lambda</span></span>
<span id="cb107-25"><a href="#cb107-25" tabindex="-1"></a>  new_lambda <span class="ot">&lt;-</span> <span class="fu">mean</span>(expected_T)</span>
<span id="cb107-26"><a href="#cb107-26" tabindex="-1"></a>  </span>
<span id="cb107-27"><a href="#cb107-27" tabindex="-1"></a>  <span class="co"># 检查收敛</span></span>
<span id="cb107-28"><a href="#cb107-28" tabindex="-1"></a>  log_likelihood_diff <span class="ot">&lt;-</span> <span class="fu">abs</span>(new_lambda <span class="sc">-</span> lambda)</span>
<span id="cb107-29"><a href="#cb107-29" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> new_lambda</span>
<span id="cb107-30"><a href="#cb107-30" tabindex="-1"></a>}</span>
<span id="cb107-31"><a href="#cb107-31" tabindex="-1"></a></span>
<span id="cb107-32"><a href="#cb107-32" tabindex="-1"></a><span class="co"># 输出结果</span></span>
<span id="cb107-33"><a href="#cb107-33" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;使用EM算法估计得到的 lambda 值为:&quot;</span>, <span class="dv">1</span><span class="sc">/</span>lambda, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 使用EM算法估计得到的 lambda 值为: 1.037037</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a><span class="co"># 使用直接观测数据的 MLE 估计</span></span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>observed_mle_lambda <span class="ot">&lt;-</span> <span class="fu">mean</span>(observed_Y)</span>
<span id="cb109-3"><a href="#cb109-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;观测数据的 MLE lambda 值为:&quot;</span>, <span class="dv">1</span><span class="sc">/</span>observed_mle_lambda, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 观测数据的 MLE lambda 值为: 1.481481</code></pre>
<p>可以发现使用EM算法估计的lambda值比直接估计的小很多，这也符合常理</p>
</div>
<div id="第八次作业" class="section level1">
<h1>第八次作业</h1>
</div>
<div id="ex-11.7" class="section level1">
<h1>EX 11.7</h1>
<p>Use the simplex algorithm to solve the following problem. Minimize 4x
+ 2y + 9z subject to</p>
<p><span class="math display">\[
\begin{aligned}
2x + y + z &amp;\leq 2, \\
x - y + 3z &amp;\leq 3, \\
x \geq 0, y \geq 0, z &amp;\geq 0.
\end{aligned}
\]</span></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a><span class="fu">library</span>(lpSolve)</span>
<span id="cb111-2"><a href="#cb111-2" tabindex="-1"></a><span class="co"># 定义目标函数的系数</span></span>
<span id="cb111-3"><a href="#cb111-3" tabindex="-1"></a>objective <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">9</span>)  <span class="co"># 对应 4x + 2y + 9z</span></span>
<span id="cb111-4"><a href="#cb111-4" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" tabindex="-1"></a><span class="co"># 定义约束矩阵</span></span>
<span id="cb111-6"><a href="#cb111-6" tabindex="-1"></a>constraints <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb111-7"><a href="#cb111-7" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>,  <span class="co"># 2x + y + z</span></span>
<span id="cb111-8"><a href="#cb111-8" tabindex="-1"></a>  <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>  <span class="co"># x - y + 3z</span></span>
<span id="cb111-9"><a href="#cb111-9" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-10"><a href="#cb111-10" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" tabindex="-1"></a><span class="co"># 定义约束的右侧值</span></span>
<span id="cb111-12"><a href="#cb111-12" tabindex="-1"></a>rhs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb111-13"><a href="#cb111-13" tabindex="-1"></a></span>
<span id="cb111-14"><a href="#cb111-14" tabindex="-1"></a><span class="co"># 定义约束的方向</span></span>
<span id="cb111-15"><a href="#cb111-15" tabindex="-1"></a>direction <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;&lt;=&quot;</span>, <span class="st">&quot;&lt;=&quot;</span>)</span>
<span id="cb111-16"><a href="#cb111-16" tabindex="-1"></a></span>
<span id="cb111-17"><a href="#cb111-17" tabindex="-1"></a><span class="co"># 求解线性规划问题 (最小化问题)</span></span>
<span id="cb111-18"><a href="#cb111-18" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">lp</span>(<span class="st">&quot;min&quot;</span>, objective, constraints, direction, rhs, <span class="at">all.int =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-19"><a href="#cb111-19" tabindex="-1"></a></span>
<span id="cb111-20"><a href="#cb111-20" tabindex="-1"></a><span class="co"># 显示结果</span></span>
<span id="cb111-21"><a href="#cb111-21" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Optimal value of the objective function:&quot;</span>, result<span class="sc">$</span>objval, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Optimal value of the objective function: 0</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Optimal values of x, y, z:&quot;</span>, result<span class="sc">$</span>solution, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Optimal values of x, y, z: 0 0 0</code></pre>
</div>
<div id="advanced-r" class="section level1">
<h1>Advanced R</h1>
<div id="page-204-ex-3" class="section level2">
<h2>Page 204 EX 3</h2>
<p>Use both for loops and lapply() to fit linear models to the mtcars
using the formulas stored in this list:</p>
<p>formulas &lt;- list( mpg ~ disp, mpg ~ I(1 / disp), mpg ~ disp + wt,
mpg ~ I(1 / disp) + wt )</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>formulas <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb115-2"><a href="#cb115-2" tabindex="-1"></a>  mpg <span class="sc">~</span> disp,</span>
<span id="cb115-3"><a href="#cb115-3" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp),</span>
<span id="cb115-4"><a href="#cb115-4" tabindex="-1"></a>  mpg <span class="sc">~</span> disp <span class="sc">+</span> wt,</span>
<span id="cb115-5"><a href="#cb115-5" tabindex="-1"></a>  mpg <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span> <span class="sc">/</span> disp) <span class="sc">+</span> wt</span>
<span id="cb115-6"><a href="#cb115-6" tabindex="-1"></a>)</span>
<span id="cb115-7"><a href="#cb115-7" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" tabindex="-1"></a><span class="co"># 创建一个空列表存储模型结果</span></span>
<span id="cb115-9"><a href="#cb115-9" tabindex="-1"></a>models_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb115-10"><a href="#cb115-10" tabindex="-1"></a></span>
<span id="cb115-11"><a href="#cb115-11" tabindex="-1"></a><span class="co"># 使用 for 循环拟合模型</span></span>
<span id="cb115-12"><a href="#cb115-12" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(formulas)) {</span>
<span id="cb115-13"><a href="#cb115-13" tabindex="-1"></a>  models_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(formulas[[i]], <span class="at">data =</span> mtcars)</span>
<span id="cb115-14"><a href="#cb115-14" tabindex="-1"></a>}</span>
<span id="cb115-15"><a href="#cb115-15" tabindex="-1"></a>models_for</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)         disp  
##    29.59985     -0.04122  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)  
##       10.75      1557.67  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)         disp           wt  
##    34.96055     -0.01772     -3.35083  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = formulas[[i]], data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)           wt  
##      19.024     1142.560       -1.798</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a><span class="co"># 使用 lapply 拟合模型</span></span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a>models_lapply <span class="ot">&lt;-</span> <span class="fu">lapply</span>(formulas, <span class="cf">function</span>(f) <span class="fu">lm</span>(f, <span class="at">data =</span> mtcars))</span>
<span id="cb117-3"><a href="#cb117-3" tabindex="-1"></a>models_lapply</span></code></pre></div>
<pre><code>## [[1]]
## 
## Call:
## lm(formula = f, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp  
##    29.59985     -0.04122  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = f, data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)  
##       10.75      1557.67  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = f, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp           wt  
##    34.96055     -0.01772     -3.35083  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = f, data = mtcars)
## 
## Coefficients:
## (Intercept)    I(1/disp)           wt  
##      19.024     1142.560       -1.798</code></pre>
</div>
<div id="ex-4" class="section level2">
<h2>EX 4</h2>
<p>Fit the model mpg ~ disp to each of the bootstrap replicates of
mtcars in the list below by using a for loop and lapply(). Can you do it
without an anonymous function?</p>
<p>bootstraps &lt;- lapply(1:10, function(i) { rows &lt;-
sample(1:nrow(mtcars), rep = TRUE) mtcars[rows, ] })</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  </span>
<span id="cb119-2"><a href="#cb119-2" tabindex="-1"></a>bootstraps <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(i) {</span>
<span id="cb119-3"><a href="#cb119-3" tabindex="-1"></a>  rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="at">rep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb119-4"><a href="#cb119-4" tabindex="-1"></a>  mtcars[rows, ]</span>
<span id="cb119-5"><a href="#cb119-5" tabindex="-1"></a>})</span>
<span id="cb119-6"><a href="#cb119-6" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" tabindex="-1"></a><span class="co"># 创建一个空列表存储模型结果</span></span>
<span id="cb119-8"><a href="#cb119-8" tabindex="-1"></a>models_for <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb119-9"><a href="#cb119-9" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" tabindex="-1"></a><span class="co"># 使用 for 循环拟合模型</span></span>
<span id="cb119-11"><a href="#cb119-11" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(bootstraps)) {</span>
<span id="cb119-12"><a href="#cb119-12" tabindex="-1"></a>  models_for[[i]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> bootstraps[[i]])</span>
<span id="cb119-13"><a href="#cb119-13" tabindex="-1"></a>}</span>
<span id="cb119-14"><a href="#cb119-14" tabindex="-1"></a></span>
<span id="cb119-15"><a href="#cb119-15" tabindex="-1"></a><span class="co"># 打印第一个模型的摘要</span></span>
<span id="cb119-16"><a href="#cb119-16" tabindex="-1"></a><span class="fu">summary</span>(models_for[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ disp, data = bootstraps[[i]])
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -5.433 -2.814 -0.870  3.000  7.002 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 29.598040   1.252594   23.63  &lt; 2e-16 ***
## disp        -0.037978   0.005091   -7.46 2.58e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.573 on 30 degrees of freedom
## Multiple R-squared:  0.6498, Adjusted R-squared:  0.6381 
## F-statistic: 55.66 on 1 and 30 DF,  p-value: 2.581e-08</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a><span class="co"># 定义一个用于拟合模型的函数</span></span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a>fit_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb121-3"><a href="#cb121-3" tabindex="-1"></a>  <span class="fu">lm</span>(mpg <span class="sc">~</span> disp, <span class="at">data =</span> data)</span>
<span id="cb121-4"><a href="#cb121-4" tabindex="-1"></a>}</span>
<span id="cb121-5"><a href="#cb121-5" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" tabindex="-1"></a><span class="co"># 使用 lapply 调用预定义的函数</span></span>
<span id="cb121-7"><a href="#cb121-7" tabindex="-1"></a>models_lapply_no_anon <span class="ot">&lt;-</span> <span class="fu">lapply</span>(bootstraps, fit_model)</span>
<span id="cb121-8"><a href="#cb121-8" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" tabindex="-1"></a><span class="co"># 打印第一个模型的摘要</span></span>
<span id="cb121-10"><a href="#cb121-10" tabindex="-1"></a><span class="fu">summary</span>(models_lapply_no_anon[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ disp, data = data)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -5.433 -2.814 -0.870  3.000  7.002 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 29.598040   1.252594   23.63  &lt; 2e-16 ***
## disp        -0.037978   0.005091   -7.46 2.58e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.573 on 30 degrees of freedom
## Multiple R-squared:  0.6498, Adjusted R-squared:  0.6381 
## F-statistic: 55.66 on 1 and 30 DF,  p-value: 2.581e-08</code></pre>
</div>
<div id="ex-5" class="section level2">
<h2>EX 5</h2>
<p>For each model in the previous two exercises, extract R2 using the
function below.</p>
<p>rsq &lt;- function(mod) summary(mod)$r.squared</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a><span class="co"># 定义提取 R^2 的函数</span></span>
<span id="cb123-2"><a href="#cb123-2" tabindex="-1"></a>rsq <span class="ot">&lt;-</span> <span class="cf">function</span>(mod) <span class="fu">summary</span>(mod)<span class="sc">$</span>r.squared</span>
<span id="cb123-3"><a href="#cb123-3" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" tabindex="-1"></a><span class="co"># 使用 for 循环结果提取 R^2</span></span>
<span id="cb123-5"><a href="#cb123-5" tabindex="-1"></a>r_squared_for <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models_for, rsq)</span>
<span id="cb123-6"><a href="#cb123-6" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb123-8"><a href="#cb123-8" tabindex="-1"></a>r_squared_for</span></code></pre></div>
<pre><code>##  [1] 0.6497636 0.6820834 0.7530595 0.6101709 0.7226119 0.7533418 0.7311415
##  [8] 0.6293502 0.6554375 0.7238971</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a><span class="co"># 使用 lapply 结果提取 R^2</span></span>
<span id="cb125-2"><a href="#cb125-2" tabindex="-1"></a>r_squared_lapply <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models_lapply, rsq)</span>
<span id="cb125-3"><a href="#cb125-3" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb125-5"><a href="#cb125-5" tabindex="-1"></a>r_squared_lapply</span></code></pre></div>
<pre><code>## [1] 0.7183433 0.8596865 0.7809306 0.8838038</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a><span class="co"># 使用无匿名函数的 lapply 结果提取 R^2</span></span>
<span id="cb127-2"><a href="#cb127-2" tabindex="-1"></a>r_squared_lapply_no_anon <span class="ot">&lt;-</span> <span class="fu">sapply</span>(models_lapply_no_anon, rsq)</span>
<span id="cb127-3"><a href="#cb127-3" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" tabindex="-1"></a><span class="co"># 查看结果</span></span>
<span id="cb127-5"><a href="#cb127-5" tabindex="-1"></a>r_squared_lapply_no_anon</span></code></pre></div>
<pre><code>##  [1] 0.6497636 0.6820834 0.7530595 0.6101709 0.7226119 0.7533418 0.7311415
##  [8] 0.6293502 0.6554375 0.7238971</code></pre>
</div>
<div id="page-213-ex-3" class="section level2">
<h2>Page 213 EX 3</h2>
<p>The following code simulates the performance of a t-test for
non-normal data. Use sapply() and an anonymous function to extract the
p-value from every trial.</p>
<p>trials &lt;- replicate( 100, t.test(rpois(10, 10), rpois(7, 10)),
simplify = FALSE )</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" tabindex="-1"></a><span class="co"># 模拟 100 次 t 检验</span></span>
<span id="cb129-2"><a href="#cb129-2" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">replicate</span>(</span>
<span id="cb129-3"><a href="#cb129-3" tabindex="-1"></a>  <span class="dv">100</span>,</span>
<span id="cb129-4"><a href="#cb129-4" tabindex="-1"></a>  <span class="fu">t.test</span>(<span class="fu">rpois</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="fu">rpois</span>(<span class="dv">7</span>, <span class="dv">10</span>)),</span>
<span id="cb129-5"><a href="#cb129-5" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb129-6"><a href="#cb129-6" tabindex="-1"></a>)</span>
<span id="cb129-7"><a href="#cb129-7" tabindex="-1"></a><span class="co"># 提取每次试验的 p 值</span></span>
<span id="cb129-8"><a href="#cb129-8" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">sapply</span>(trials, <span class="cf">function</span>(trial) trial<span class="sc">$</span>p.value)</span>
<span id="cb129-9"><a href="#cb129-9" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" tabindex="-1"></a><span class="co"># 查看前几个 p 值</span></span>
<span id="cb129-11"><a href="#cb129-11" tabindex="-1"></a><span class="fu">head</span>(p_values)</span></code></pre></div>
<pre><code>## [1] 0.8079199 0.6655118 0.8277717 0.5348996 0.2117373 0.5286436</code></pre>
</div>
<div id="ex-6" class="section level2">
<h2>EX 6</h2>
<p>Implement a combination of Map() and vapply() to create an lapply()
variant that iterates in parallel over all of its inputs and stores its
outputs in a vector (or a matrix). What arguments should the function
take?</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" tabindex="-1"></a><span class="co"># 自定义函数，结合 Map() 和 vapply()</span></span>
<span id="cb131-2"><a href="#cb131-2" tabindex="-1"></a>parallel_apply <span class="ot">&lt;-</span> <span class="cf">function</span>(FUN, ..., FUN.VALUE) {</span>
<span id="cb131-3"><a href="#cb131-3" tabindex="-1"></a>  <span class="co"># 使用 Map 并行应用函数到所有输入</span></span>
<span id="cb131-4"><a href="#cb131-4" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">Map</span>(FUN, ...)</span>
<span id="cb131-5"><a href="#cb131-5" tabindex="-1"></a>  </span>
<span id="cb131-6"><a href="#cb131-6" tabindex="-1"></a>  <span class="co"># 使用 vapply 确保输出为指定类型的向量或矩阵</span></span>
<span id="cb131-7"><a href="#cb131-7" tabindex="-1"></a>  <span class="fu">vapply</span>(results, identity, FUN.VALUE)</span>
<span id="cb131-8"><a href="#cb131-8" tabindex="-1"></a>}</span>
<span id="cb131-9"><a href="#cb131-9" tabindex="-1"></a></span>
<span id="cb131-10"><a href="#cb131-10" tabindex="-1"></a><span class="co"># 示例 1：两个输入的并行相加</span></span>
<span id="cb131-11"><a href="#cb131-11" tabindex="-1"></a><span class="co"># 定义输入列表</span></span>
<span id="cb131-12"><a href="#cb131-12" tabindex="-1"></a>input1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb131-13"><a href="#cb131-13" tabindex="-1"></a>input2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb131-14"><a href="#cb131-14" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" tabindex="-1"></a><span class="co"># 定义需要应用的函数</span></span>
<span id="cb131-16"><a href="#cb131-16" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) a <span class="sc">+</span> b</span>
<span id="cb131-17"><a href="#cb131-17" tabindex="-1"></a></span>
<span id="cb131-18"><a href="#cb131-18" tabindex="-1"></a><span class="co"># 调用自定义函数</span></span>
<span id="cb131-19"><a href="#cb131-19" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">parallel_apply</span>(my_function, input1, input2, <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb131-20"><a href="#cb131-20" tabindex="-1"></a><span class="fu">print</span>(result)  <span class="co"># 输出: [1] 5 7 9</span></span></code></pre></div>
<pre><code>## [1] 5 7 9</code></pre>
<p>输出矩阵的实例</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a><span class="co"># 定义输入列表</span></span>
<span id="cb133-2"><a href="#cb133-2" tabindex="-1"></a>input1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb133-3"><a href="#cb133-3" tabindex="-1"></a>input2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb133-4"><a href="#cb133-4" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" tabindex="-1"></a><span class="co"># 定义需要应用的函数，返回一个长度为2的向量</span></span>
<span id="cb133-6"><a href="#cb133-6" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) <span class="fu">c</span>(a, b)</span>
<span id="cb133-7"><a href="#cb133-7" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" tabindex="-1"></a><span class="co"># 调用自定义函数</span></span>
<span id="cb133-9"><a href="#cb133-9" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">parallel_apply</span>(my_function, input1, input2, <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">2</span>))</span>
<span id="cb133-10"><a href="#cb133-10" tabindex="-1"></a><span class="fu">print</span>(result)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    2    3
## [2,]    4    5    6</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a><span class="co"># 输出：一个 2 行矩阵</span></span>
<span id="cb135-2"><a href="#cb135-2" tabindex="-1"></a><span class="co">#      [,1] [,2] [,3]</span></span>
<span id="cb135-3"><a href="#cb135-3" tabindex="-1"></a><span class="co"># [1,]    1    2    3</span></span>
<span id="cb135-4"><a href="#cb135-4" tabindex="-1"></a><span class="co"># [2,]    4    5    6</span></span></code></pre></div>
</div>
<div id="page-365-ex-4" class="section level2">
<h2>Page 365 EX 4</h2>
<ol start="4" style="list-style-type: decimal">
<li>Make a faster version of chisq.test() that only computes the
chi-square test statistic when the input is two numeric vectors with no
missing values. You can try simplifying chisq.test() or by coding from
the mathematical definition (<a href="http://en" class="uri">http://en</a>.
wikipedia.org/wiki/Pearson%27s_chi-squared_test).</li>
</ol>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a><span class="co"># 自定义快速卡方检验函数</span></span>
<span id="cb136-2"><a href="#cb136-2" tabindex="-1"></a>fast_chisq_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb136-3"><a href="#cb136-3" tabindex="-1"></a>  <span class="co"># 检查输入是否为数值向量，且无缺失值</span></span>
<span id="cb136-4"><a href="#cb136-4" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(x) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.numeric</span>(y)) <span class="fu">stop</span>(<span class="st">&quot;Inputs must be numeric vectors.&quot;</span>)</span>
<span id="cb136-5"><a href="#cb136-5" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">anyNA</span>(x) <span class="sc">||</span> <span class="fu">anyNA</span>(y)) <span class="fu">stop</span>(<span class="st">&quot;Inputs must not contain missing values.&quot;</span>)</span>
<span id="cb136-6"><a href="#cb136-6" tabindex="-1"></a>  </span>
<span id="cb136-7"><a href="#cb136-7" tabindex="-1"></a>  <span class="co"># 构建二维列联表</span></span>
<span id="cb136-8"><a href="#cb136-8" tabindex="-1"></a>  contingency_table <span class="ot">&lt;-</span> <span class="fu">table</span>(x, y)</span>
<span id="cb136-9"><a href="#cb136-9" tabindex="-1"></a>  </span>
<span id="cb136-10"><a href="#cb136-10" tabindex="-1"></a>  <span class="co"># 计算行和、列和以及总和</span></span>
<span id="cb136-11"><a href="#cb136-11" tabindex="-1"></a>  row_sums <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(contingency_table)</span>
<span id="cb136-12"><a href="#cb136-12" tabindex="-1"></a>  col_sums <span class="ot">&lt;-</span> <span class="fu">colSums</span>(contingency_table)</span>
<span id="cb136-13"><a href="#cb136-13" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fu">sum</span>(contingency_table)</span>
<span id="cb136-14"><a href="#cb136-14" tabindex="-1"></a>  </span>
<span id="cb136-15"><a href="#cb136-15" tabindex="-1"></a>  <span class="co"># 计算期望值</span></span>
<span id="cb136-16"><a href="#cb136-16" tabindex="-1"></a>  expected <span class="ot">&lt;-</span> <span class="fu">outer</span>(row_sums, col_sums) <span class="sc">/</span> total</span>
<span id="cb136-17"><a href="#cb136-17" tabindex="-1"></a>  </span>
<span id="cb136-18"><a href="#cb136-18" tabindex="-1"></a>  <span class="co"># 计算卡方统计量</span></span>
<span id="cb136-19"><a href="#cb136-19" tabindex="-1"></a>  observed <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(contingency_table)</span>
<span id="cb136-20"><a href="#cb136-20" tabindex="-1"></a>  expected <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(expected)</span>
<span id="cb136-21"><a href="#cb136-21" tabindex="-1"></a>  chisq_statistic <span class="ot">&lt;-</span> <span class="fu">sum</span>((observed <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected)</span>
<span id="cb136-22"><a href="#cb136-22" tabindex="-1"></a>  </span>
<span id="cb136-23"><a href="#cb136-23" tabindex="-1"></a>  <span class="co"># 返回卡方统计量</span></span>
<span id="cb136-24"><a href="#cb136-24" tabindex="-1"></a>  <span class="fu">return</span>(chisq_statistic)</span>
<span id="cb136-25"><a href="#cb136-25" tabindex="-1"></a>}</span>
<span id="cb136-26"><a href="#cb136-26" tabindex="-1"></a></span>
<span id="cb136-27"><a href="#cb136-27" tabindex="-1"></a><span class="co"># 示例：测试代码</span></span>
<span id="cb136-28"><a href="#cb136-28" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb136-29"><a href="#cb136-29" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb136-30"><a href="#cb136-30" tabindex="-1"></a><span class="fu">fast_chisq_test</span>(x, y)</span></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a><span class="co"># 比较运行速度</span></span>
<span id="cb138-2"><a href="#cb138-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb138-3"><a href="#cb138-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fl">1e7</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb138-4"><a href="#cb138-4" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fl">1e7</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb138-5"><a href="#cb138-5" tabindex="-1"></a></span>
<span id="cb138-6"><a href="#cb138-6" tabindex="-1"></a><span class="co"># 原始 chisq.test</span></span>
<span id="cb138-7"><a href="#cb138-7" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb138-8"><a href="#cb138-8" tabindex="-1"></a>  chisq_result <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(x, y)<span class="sc">$</span>statistic</span>
<span id="cb138-9"><a href="#cb138-9" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>##    user  system elapsed 
##    0.77    0.06    1.00</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" tabindex="-1"></a><span class="co"># 快速实现 fast_chisq_test</span></span>
<span id="cb140-2"><a href="#cb140-2" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb140-3"><a href="#cb140-3" tabindex="-1"></a>  fast_result <span class="ot">&lt;-</span> <span class="fu">fast_chisq_test</span>(x, y)</span>
<span id="cb140-4"><a href="#cb140-4" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>##    user  system elapsed 
##    0.64    0.00    0.71</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" tabindex="-1"></a><span class="co"># 验证两者结果一致性</span></span>
<span id="cb142-2"><a href="#cb142-2" tabindex="-1"></a><span class="co"># 忽略名字属性</span></span>
<span id="cb142-3"><a href="#cb142-3" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unname</span>(chisq_result), fast_result)  <span class="co"># TRUE</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="ex-5-1" class="section level2">
<h2>EX 5</h2>
<p>Can you make a faster version of table() for the case of an input of
two integer vectors with no missing values? Can you use it to speed up
your chi-square test?</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" tabindex="-1"></a>fast_table <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb144-2"><a href="#cb144-2" tabindex="-1"></a>  <span class="co"># 假设 x 和 y 都是整数向量，并且没有缺失值</span></span>
<span id="cb144-3"><a href="#cb144-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">length</span>(x), <span class="fu">length</span>(y))</span>
<span id="cb144-4"><a href="#cb144-4" tabindex="-1"></a>  </span>
<span id="cb144-5"><a href="#cb144-5" tabindex="-1"></a>  <span class="co"># 直接计算二维频数表</span></span>
<span id="cb144-6"><a href="#cb144-6" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">max</span>(x), <span class="at">ncol =</span> <span class="fu">max</span>(y))</span>
<span id="cb144-7"><a href="#cb144-7" tabindex="-1"></a>  </span>
<span id="cb144-8"><a href="#cb144-8" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(n)) {</span>
<span id="cb144-9"><a href="#cb144-9" tabindex="-1"></a>    res[x[i], y[i]] <span class="ot">&lt;-</span> res[x[i], y[i]] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb144-10"><a href="#cb144-10" tabindex="-1"></a>  }</span>
<span id="cb144-11"><a href="#cb144-11" tabindex="-1"></a>  </span>
<span id="cb144-12"><a href="#cb144-12" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb144-13"><a href="#cb144-13" tabindex="-1"></a>}</span>
<span id="cb144-14"><a href="#cb144-14" tabindex="-1"></a></span>
<span id="cb144-15"><a href="#cb144-15" tabindex="-1"></a>fast_chisq_test <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb144-16"><a href="#cb144-16" tabindex="-1"></a>  <span class="co"># 计算快速频次表</span></span>
<span id="cb144-17"><a href="#cb144-17" tabindex="-1"></a>  freq_table <span class="ot">&lt;-</span> <span class="fu">fast_table</span>(x, y)</span>
<span id="cb144-18"><a href="#cb144-18" tabindex="-1"></a>  </span>
<span id="cb144-19"><a href="#cb144-19" tabindex="-1"></a>  <span class="co"># 计算卡方统计量</span></span>
<span id="cb144-20"><a href="#cb144-20" tabindex="-1"></a>  expected <span class="ot">&lt;-</span> <span class="fu">outer</span>(<span class="fu">rowSums</span>(freq_table), <span class="fu">colSums</span>(freq_table), <span class="st">&quot;*&quot;</span>) <span class="sc">/</span> <span class="fu">sum</span>(freq_table)</span>
<span id="cb144-21"><a href="#cb144-21" tabindex="-1"></a>  chisq_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>((freq_table <span class="sc">-</span> expected)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> expected)</span>
<span id="cb144-22"><a href="#cb144-22" tabindex="-1"></a>  </span>
<span id="cb144-23"><a href="#cb144-23" tabindex="-1"></a>  <span class="fu">return</span>(chisq_stat)</span>
<span id="cb144-24"><a href="#cb144-24" tabindex="-1"></a>}</span>
<span id="cb144-25"><a href="#cb144-25" tabindex="-1"></a></span>
<span id="cb144-26"><a href="#cb144-26" tabindex="-1"></a><span class="co"># 验证结果的一致性</span></span>
<span id="cb144-27"><a href="#cb144-27" tabindex="-1"></a>chisq_result <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(x, y)<span class="sc">$</span>statistic</span>
<span id="cb144-28"><a href="#cb144-28" tabindex="-1"></a>fast_result <span class="ot">&lt;-</span> <span class="fu">fast_chisq_test</span>(x, y)</span>
<span id="cb144-29"><a href="#cb144-29" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unname</span>(chisq_result), fast_result) </span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
</div>
<div id="第九次作业" class="section level1">
<h1>第九次作业</h1>
</div>
<div id="ex-9.8-1" class="section level1">
<h1>EX 9.8</h1>
<p>The bivariate density is defined as follows:</p>
<p><span class="math display">\[
f(x, y) \propto {n\choose k} \cdot y^{x+a-1} \cdot (1-y)^{n-x+b-1},
\quad x = 0, 1, \ldots, n, \quad 0 \leq y \leq 1.
\]</span></p>
<p>For fixed parameters <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(n\)</span>: - The conditional distribution of
<span class="math inline">\(x | y\)</span> is <span class="math inline">\(\text{Binomial}(n, y)\)</span>. - The conditional
distribution of <span class="math inline">\(y | x\)</span> is <span class="math inline">\(\text{Beta}(x + a, n - x + b)\)</span>.</p>
<p>We will use the Gibbs sampler to generate a chain targeting this
joint density.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span></code></pre></div>
<pre><code>## Warning: package &#39;Rcpp&#39; was built under R version 4.3.3</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 4.3.3</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" tabindex="-1"></a><span class="co"># 使用Rcpp实现Gibbs采样器</span></span>
<span id="cb150-2"><a href="#cb150-2" tabindex="-1"></a>dir_cpp <span class="ot">&lt;-</span> <span class="st">&#39;E:/Rstudio/R_project/Rcpp/&#39;</span></span>
<span id="cb150-3"><a href="#cb150-3" tabindex="-1"></a><span class="fu">sourceCpp</span>(<span class="fu">paste0</span>(dir_cpp,<span class="st">&quot;gibbs_sampler.cpp&quot;</span>))</span>
<span id="cb150-4"><a href="#cb150-4" tabindex="-1"></a></span>
<span id="cb150-5"><a href="#cb150-5" tabindex="-1"></a><span class="co"># 参数设置</span></span>
<span id="cb150-6"><a href="#cb150-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb150-7"><a href="#cb150-7" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span>; b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb150-8"><a href="#cb150-8" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb150-9"><a href="#cb150-9" tabindex="-1"></a>num_iter <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb150-10"><a href="#cb150-10" tabindex="-1"></a>gibbs_chain <span class="ot">&lt;-</span> <span class="fu">gibbs_sampler</span>(num_iter, a, b, n, <span class="fl">0.5</span>)</span>
<span id="cb150-11"><a href="#cb150-11" tabindex="-1"></a>gibbs_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span>num_iter, <span class="at">x =</span> gibbs_chain[, <span class="dv">1</span>], <span class="at">y =</span> gibbs_chain[, <span class="dv">2</span>])</span>
<span id="cb150-12"><a href="#cb150-12" tabindex="-1"></a></span>
<span id="cb150-13"><a href="#cb150-13" tabindex="-1"></a><span class="fu">ggplot</span>(gibbs_df, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb150-14"><a href="#cb150-14" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb150-15"><a href="#cb150-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;样本直方图：x&quot;</span>, <span class="at">x =</span> <span class="st">&quot;x&quot;</span>, <span class="at">y =</span> <span class="st">&quot;频率&quot;</span>)</span>
<span id="cb150-16"><a href="#cb150-16" tabindex="-1"></a></span>
<span id="cb150-17"><a href="#cb150-17" tabindex="-1"></a><span class="fu">ggplot</span>(gibbs_df, <span class="fu">aes</span>(<span class="at">x =</span> y)) <span class="sc">+</span></span>
<span id="cb150-18"><a href="#cb150-18" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb150-19"><a href="#cb150-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;样本直方图：y&quot;</span>, <span class="at">x =</span> <span class="st">&quot;y&quot;</span>, <span class="at">y =</span> <span class="st">&quot;频率&quot;</span>)</span></code></pre></div>
<p>两张图像分别代表x和y的边缘分布</p>
<p>Compare the corresponding generated random numbers with those by the
R function you wrote using the function “qqplot”.</p>
<p>我们将使用R写一个与Rcpp类似的Gibbs采样器</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">paste0</span>(dir_cpp,<span class="st">&#39;GibbsR.R&#39;</span>))</span>
<span id="cb151-2"><a href="#cb151-2" tabindex="-1"></a><span class="co"># 参数设置</span></span>
<span id="cb151-3"><a href="#cb151-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb151-4"><a href="#cb151-4" tabindex="-1"></a>num_iter <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb151-5"><a href="#cb151-5" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span>; b <span class="ot">&lt;-</span> <span class="dv">2</span>; n <span class="ot">&lt;-</span> <span class="dv">10</span>; y_init <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb151-6"><a href="#cb151-6" tabindex="-1"></a></span>
<span id="cb151-7"><a href="#cb151-7" tabindex="-1"></a><span class="co"># 运行R版本的Gibbs采样器</span></span>
<span id="cb151-8"><a href="#cb151-8" tabindex="-1"></a>gibbs_chain_r <span class="ot">&lt;-</span> <span class="fu">gibbs_sampler_r</span>(num_iter, a, b, n, y_init)</span></code></pre></div>
<p>使用qqplot比较两种生成结果的相似性</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" tabindex="-1"></a>gibbs_chain_cpp <span class="ot">&lt;-</span> <span class="fu">gibbs_sampler</span>(num_iter, a, b, n, y_init)</span>
<span id="cb152-2"><a href="#cb152-2" tabindex="-1"></a>gibbs_chain_cpp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> gibbs_chain_cpp[, <span class="dv">1</span>], <span class="at">y =</span> gibbs_chain_cpp[, <span class="dv">2</span>])</span>
<span id="cb152-3"><a href="#cb152-3" tabindex="-1"></a></span>
<span id="cb152-4"><a href="#cb152-4" tabindex="-1"></a><span class="co"># 比较x的随机数</span></span>
<span id="cb152-5"><a href="#cb152-5" tabindex="-1"></a><span class="fu">qqplot</span>(</span>
<span id="cb152-6"><a href="#cb152-6" tabindex="-1"></a>  gibbs_chain_r<span class="sc">$</span>x, gibbs_chain_cpp<span class="sc">$</span>x,</span>
<span id="cb152-7"><a href="#cb152-7" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;x Q-Q Plot&quot;</span>,</span>
<span id="cb152-8"><a href="#cb152-8" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;R&quot;</span>,</span>
<span id="cb152-9"><a href="#cb152-9" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Rcpp&quot;</span>,</span>
<span id="cb152-10"><a href="#cb152-10" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb152-11"><a href="#cb152-11" tabindex="-1"></a>)</span>
<span id="cb152-12"><a href="#cb152-12" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb152-13"><a href="#cb152-13" tabindex="-1"></a></span>
<span id="cb152-14"><a href="#cb152-14" tabindex="-1"></a><span class="co"># 比较y的随机数</span></span>
<span id="cb152-15"><a href="#cb152-15" tabindex="-1"></a><span class="fu">qqplot</span>(</span>
<span id="cb152-16"><a href="#cb152-16" tabindex="-1"></a>  gibbs_chain_r<span class="sc">$</span>y, gibbs_chain_cpp<span class="sc">$</span>y,</span>
<span id="cb152-17"><a href="#cb152-17" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;y Q-Q Plot&quot;</span>,</span>
<span id="cb152-18"><a href="#cb152-18" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;R&quot;</span>,</span>
<span id="cb152-19"><a href="#cb152-19" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Rcpp&quot;</span>,</span>
<span id="cb152-20"><a href="#cb152-20" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb152-21"><a href="#cb152-21" tabindex="-1"></a>)</span>
<span id="cb152-22"><a href="#cb152-22" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>观察图像发现Q-Q图上的点沿对角线排列(即紧密贴合直线y =
x)，说明两种随机数生成方式类似</p>
<p>Campare the computation time of the two functions with the function
“microbenchmark”</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" tabindex="-1"></a><span class="co"># 加载 microbenchmark 包</span></span>
<span id="cb153-2"><a href="#cb153-2" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb153-3"><a href="#cb153-3" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" tabindex="-1"></a><span class="co"># 设置参数</span></span>
<span id="cb153-5"><a href="#cb153-5" tabindex="-1"></a>num_iter <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb153-6"><a href="#cb153-6" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span>; b <span class="ot">&lt;-</span> <span class="dv">2</span>; n <span class="ot">&lt;-</span> <span class="dv">10</span>; y_init <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb153-7"><a href="#cb153-7" tabindex="-1"></a></span>
<span id="cb153-8"><a href="#cb153-8" tabindex="-1"></a><span class="co"># 测试性能</span></span>
<span id="cb153-9"><a href="#cb153-9" tabindex="-1"></a>benchmark_results <span class="ot">&lt;-</span> <span class="fu">microbenchmark</span>(</span>
<span id="cb153-10"><a href="#cb153-10" tabindex="-1"></a>  <span class="at">R_version =</span> <span class="fu">gibbs_sampler_r</span>(num_iter, a, b, n, y_init),</span>
<span id="cb153-11"><a href="#cb153-11" tabindex="-1"></a>  <span class="at">Rcpp_version =</span> <span class="fu">gibbs_sampler</span>(num_iter, a, b, n, y_init),</span>
<span id="cb153-12"><a href="#cb153-12" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">10</span> <span class="co"># 每个函数运行10次</span></span>
<span id="cb153-13"><a href="#cb153-13" tabindex="-1"></a>)</span>
<span id="cb153-14"><a href="#cb153-14" tabindex="-1"></a></span>
<span id="cb153-15"><a href="#cb153-15" tabindex="-1"></a><span class="co"># 显示结果</span></span>
<span id="cb153-16"><a href="#cb153-16" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(benchmark_results)[, <span class="fu">c</span>(<span class="st">&quot;expr&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;max&quot;</span>)])</span>
<span id="cb153-17"><a href="#cb153-17" tabindex="-1"></a></span>
<span id="cb153-18"><a href="#cb153-18" tabindex="-1"></a><span class="co"># 可视化性能比较</span></span>
<span id="cb153-19"><a href="#cb153-19" tabindex="-1"></a><span class="fu">boxplot</span>(benchmark_results, <span class="at">main =</span> <span class="st">&quot;Performance Comparison&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Execution Time (ns)&quot;</span>)</span></code></pre></div>
<p>可以发现Rcpp运行速度明显快于R代码的运行速度</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
